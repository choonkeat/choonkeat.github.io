---
layout: post
title: 'ActiveRecord: Optimistic Offline Lock'
published: true
category:
- rails
---
<p>Find of the day for me: Rails' ActiveRecord <a href="http://www.ruby-forum.com/topic/61754#62324">supports Optimistic Offline Lock via lock_version column</a>. i.e. <a href="http://www.martinfowler.com/eaaCatalog/optimisticOfflineLock.html">this</a><br /></p><pre><span class="punct">&gt;&gt;</span> <span class="ident">duck1</span> <span class="punct">=</span> <span class="constant">Duck</span><span class="punct">.</span><span class="ident">find_by_name</span> <span class="punct">&quot;</span><span class="string">Daffy</span><span class="punct">&quot;</span><br /><span class="punct">=&gt;</span> <span class="comment">#&lt;Duck:0xb75d2f64 @attributes={&quot;name&quot;=&gt;&quot;Daffy&quot;, &quot;lock_version&quot;=&gt;&quot;0&quot;, &quot;id&quot;=&gt;&quot;1&quot;}&gt;</span><br /><span class="punct">&gt;&gt;</span> <span class="ident">duck2</span> <span class="punct">=</span> <span class="constant">Duck</span><span class="punct">.</span><span class="ident">find_by_name</span> <span class="punct">&quot;</span><span class="string">Daffy</span><span class="punct">&quot;</span><br /><span class="punct">=&gt;</span> <span class="comment">#&lt;Duck:0xb75cd08c @attributes={&quot;name&quot;=&gt;&quot;Daffy&quot;, &quot;lock_version&quot;=&gt;&quot;0&quot;, &quot;id&quot;=&gt;&quot;1&quot;}&gt;</span><br /><span class="punct">&gt;&gt;</span> <span class="ident">duck1</span><span class="punct">.</span><span class="ident">name</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">Daffy le duck</span><span class="punct">&quot;</span><br /><span class="punct">=&gt;</span> <span class="punct">&quot;</span><span class="string">Daffy le duck</span><span class="punct">&quot;</span><br /><span class="punct">&gt;&gt;</span> <span class="ident">duck2</span><span class="punct">.</span><span class="ident">name</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">Donald</span><span class="punct">&quot;</span><br /><span class="punct">=&gt;</span> <span class="punct">&quot;</span><span class="string">Donald</span><span class="punct">&quot;</span><br /><span class="punct">&gt;&gt;</span> <span class="ident">duck1</span><span class="punct">.</span><span class="ident">save</span><br /><span class="punct">=&gt;</span> <span class="constant">true</span><br /><span class="punct">&gt;&gt;</span> <span class="ident">duck2</span><span class="punct">.</span><span class="ident">save</span><br /><span class="constant">ActiveRecord</span><span class="punct">::</span><span class="constant">StaleObjectError</span><span class="punct">:</span> <span class="constant">Attempted</span> <span class="ident">to</span> <span class="ident">update</span> <span class="ident">a</span> <span class="ident">stale</span> <span class="ident">object</span> </pre>
