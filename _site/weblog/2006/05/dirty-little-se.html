<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>Dirty Little Secret | The Devel!</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="Dirty Little Secret" />
<meta name="author" content="choonkeat" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I&#39;ve been doing more Rails development lately (yay!) but have something shameful to admit: &lt;blockquote&gt; &lt;p&gt; I don&#39;t care what &lt;a href=&quot;http://blog.hasmanythrough.com/articles/2006/04/20/many-to-many-dance-off&quot;&gt;variant of many-to-many relationship&lt;/a&gt; the models have, I bulldoze with a same implementation everytime. &lt;/p&gt; &lt;/blockquote&gt; &lt;p&gt;The &lt;a href=&quot;http://blog.hasmanythrough.com/articles/category/associations&quot;&gt;nuances and gotchas&lt;/a&gt; are too much for my liking. So rather than spending time groking them and risk &lt;a href=&quot;http://dev.rubyonrails.org/changeset/4123&quot;&gt;seeing them deprecated&lt;/a&gt; (not complaining, just note things are moving fast), I&#39;d prefer to rely on simpler concepts which are hence more stable and has &lt;a href=&quot;http://www.artima.com/intv/ruby4.html&quot;&gt;least-surprise&lt;/a&gt; behaviors. Use the time saved to think about real important stuff: business requirements.&lt;br /&gt; &lt;/p&gt; &lt;p&gt;Simplifying the concept will mean a tiny bit more code - but lesser wrestling with the framework overall, IMHO. To represent any many-to-many relationship, opt for a rich-association database setup everytime (aka include an auto_increment id in the join table), regardless of whether there&#39;ll ultimately be extra attributes. Defer decisions. Hence, &lt;em&gt;people.id == people_skills.person_id and&amp;nbsp; people_skills.skill_id == skills.id&lt;/em&gt; in the database will be represented in ActiveRecord as:&lt;br /&gt; &lt;/p&gt; &lt;pre&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;class&lt;/font&gt;&lt;/strong&gt; Person &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; ActiveRecord&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;Base&lt;br /&gt; has_and_belongs_to_many &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;skills&lt;br /&gt; has_many &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;people_skills&lt;font color=&quot;#990000&quot;&gt;,&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;dependent &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;destroy&lt;br /&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;end&lt;/font&gt;&lt;/strong&gt;&lt;br /&gt; &lt;br /&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;class&lt;/font&gt;&lt;/strong&gt; Skill &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; ActiveRecord&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;Base&lt;br /&gt; has_and_belongs_to_many &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;people&lt;br /&gt; has_many &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;people_skills&lt;font color=&quot;#990000&quot;&gt;,&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;dependent &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;destroy&lt;br /&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;end&lt;/font&gt;&lt;/strong&gt;&lt;br /&gt; &lt;br /&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;class&lt;/font&gt;&lt;/strong&gt; PeopleSkill &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; ActiveRecord&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;Base&lt;br /&gt; set_primary_key &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;not_id &lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;# int auto_increment primary key, cannot be named &#39;id&#39;&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; belongs_to &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;person&lt;br /&gt; belongs_to &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;skill&lt;br /&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;end&lt;/font&gt;&lt;/strong&gt;&lt;/pre&gt; &lt;p&gt;There 2 lines more than &lt;em&gt;rightfully necessary&lt;/em&gt;. But all the data will surely be accessible. If things turns out to be simple, your overhead is negligible. If requirements turns hairy, you&#39;re still safe! No worrying over any potential &lt;em&gt;has_many :through&lt;/em&gt; quirks, or lack of support with &lt;em&gt;has_and_belongs_to_many&lt;/em&gt;. Just go with the above setup - get some code running! - and everything can be optimised later. Wrestling more and things will begin to feel like unnecessary situps to me...&lt;/p&gt; &lt;p&gt;[Update]&lt;br /&gt; Fixed the sample code above, apparently PeopleSkill&#39;s primary key should not be named :id. So its 3 additional lines instead of 2. A tour via ./script/console will be&lt;br /&gt; &lt;/p&gt; &lt;pre&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; Person&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;delete_all&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#993399&quot;&gt;0&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; Skill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;delete_all&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#993399&quot;&gt;0&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; PeopleSkill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;delete_all&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#993399&quot;&gt;0&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; s &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt; Skill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;create &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;name &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#ff0000&quot;&gt;&amp;quot;Swimming&amp;quot;&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&amp;lt;Skill:0xb7855b3c ...&amp;gt;&amp;gt;&amp;gt;&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jack &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt; Person&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;create &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;name &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#ff0000&quot;&gt;&amp;quot;Jack&amp;quot;&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Person:0xb784da04 @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Jack&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb784b268 @errors={}, @base=#&amp;lt;Person:0xb784da04 ...&amp;gt;&amp;gt;&amp;gt;&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jill &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt; Person&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;create &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;name &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#ff0000&quot;&gt;&amp;quot;Jill&amp;quot;&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Person:0xb784181c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Jill&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;2}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb783eb30 @errors={}, @base=#&amp;lt;Person:0xb784181c ...&amp;gt;&amp;gt;&amp;gt;&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jack&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;skills &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; s&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&amp;lt;Skill:0xb7855b3c ...&amp;gt;&amp;gt;&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;skills &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; s&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&amp;lt;Skill:0xb7855b3c ...&amp;gt;&amp;gt;&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; PeopleSkill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#000000&quot;&gt;find&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;all&lt;font color=&quot;#990000&quot;&gt;)&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;PeopleSkill:0xb781206c @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;}&amp;gt;, #&amp;lt;PeopleSkill:0xb7811ef0 @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;}&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jack&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;skills &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; Skill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#000000&quot;&gt;create&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;name &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#ff0000&quot;&gt;&amp;quot;Dancing&amp;quot;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;)&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&amp;lt;Skill:0xb7855b3c ...&amp;gt;&amp;gt;&amp;gt;, #&amp;lt;Skill:0xb7809994 @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Dancing&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;2}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb7807f04 @errors={}, @base=#&amp;lt;Skill:0xb7809994 ...&amp;gt;&amp;gt;&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;skills &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; Skill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#000000&quot;&gt;create&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;name &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#ff0000&quot;&gt;&amp;quot;Cooking&amp;quot;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;)&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&amp;lt;Skill:0xb7855b3c ...&amp;gt;&amp;gt;&amp;gt;, #&amp;lt;Skill:0xb77f5930 @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Cooking&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;3}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb77f3b44 @errors={}, @base=#&amp;lt;Skill:0xb77f5930 ...&amp;gt;&amp;gt;&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jack&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#000000&quot;&gt;skills&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;(&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;true&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;)&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb77e2970 @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;}, @readonly=true&amp;gt;, #&amp;lt;Skill:0xb77e2934 @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Dancing&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;, &amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;3&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;}, @readonly=true&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jack&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;destroy&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Person:0xb784da04 @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Jack&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @skills=[], @new_record=false, @people_skills=[#&amp;lt;PeopleSkill:0xb77dce94 @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;}&amp;gt;, #&amp;lt;PeopleSkill:0xb77dcd54 @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;3&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;}&amp;gt;], @errors=#&amp;lt;ActiveRecord::Errors:0xb784b268 @errors={}, @base=#&amp;lt;Person:0xb784da04 ...&amp;gt;&amp;gt;&amp;gt;&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; PeopleSkill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#000000&quot;&gt;find&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;all&lt;font color=&quot;#990000&quot;&gt;)&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;PeopleSkill:0xb77cef88 @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;}&amp;gt;, #&amp;lt;PeopleSkill:0xb77cef38 @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;4&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;3&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;}&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; quit &lt;/pre&gt; &lt;p&gt;The reason the original sample code wasn&#39;t working was &lt;strong&gt;not&lt;/strong&gt; because of HABTM didn&#39;t create the primary key (as mentioned by Josh in the comments), but rather its precisely because it did try to include the id column in the INSERT statement (with a wrong value) thus causing primary key clashes and blah blah blah. Strangely, by changing PeopleSkill&#39;s primary key to be named something else, the INSERT statement would exclude it and insert only (`skill_id`, `person_id`), allowing MySQL to auto_generate the primary key.&lt;/p&gt; &lt;p&gt;As long as the primary keys of Person and Skill are not called &amp;quot;id&amp;quot;, PeopleSkill can happily use &amp;quot;id&amp;quot; as its auto increment primary key (as is with my original work). My force is not strong enough to attempt a patch / further investigation for this HABTM issue.&amp;nbsp;&lt;/p&gt;&lt;p&gt;[Update 2]&lt;br /&gt;Plugin available to make habtm behave: &lt;a href=&quot;../../../files/ticket5216.zip&quot;&gt;Download&lt;/a&gt; and unzip into your vendor/plugins folder.&lt;br /&gt;&lt;/p&gt;" />
<meta property="og:description" content="I&#39;ve been doing more Rails development lately (yay!) but have something shameful to admit: &lt;blockquote&gt; &lt;p&gt; I don&#39;t care what &lt;a href=&quot;http://blog.hasmanythrough.com/articles/2006/04/20/many-to-many-dance-off&quot;&gt;variant of many-to-many relationship&lt;/a&gt; the models have, I bulldoze with a same implementation everytime. &lt;/p&gt; &lt;/blockquote&gt; &lt;p&gt;The &lt;a href=&quot;http://blog.hasmanythrough.com/articles/category/associations&quot;&gt;nuances and gotchas&lt;/a&gt; are too much for my liking. So rather than spending time groking them and risk &lt;a href=&quot;http://dev.rubyonrails.org/changeset/4123&quot;&gt;seeing them deprecated&lt;/a&gt; (not complaining, just note things are moving fast), I&#39;d prefer to rely on simpler concepts which are hence more stable and has &lt;a href=&quot;http://www.artima.com/intv/ruby4.html&quot;&gt;least-surprise&lt;/a&gt; behaviors. Use the time saved to think about real important stuff: business requirements.&lt;br /&gt; &lt;/p&gt; &lt;p&gt;Simplifying the concept will mean a tiny bit more code - but lesser wrestling with the framework overall, IMHO. To represent any many-to-many relationship, opt for a rich-association database setup everytime (aka include an auto_increment id in the join table), regardless of whether there&#39;ll ultimately be extra attributes. Defer decisions. Hence, &lt;em&gt;people.id == people_skills.person_id and&amp;nbsp; people_skills.skill_id == skills.id&lt;/em&gt; in the database will be represented in ActiveRecord as:&lt;br /&gt; &lt;/p&gt; &lt;pre&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;class&lt;/font&gt;&lt;/strong&gt; Person &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; ActiveRecord&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;Base&lt;br /&gt; has_and_belongs_to_many &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;skills&lt;br /&gt; has_many &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;people_skills&lt;font color=&quot;#990000&quot;&gt;,&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;dependent &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;destroy&lt;br /&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;end&lt;/font&gt;&lt;/strong&gt;&lt;br /&gt; &lt;br /&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;class&lt;/font&gt;&lt;/strong&gt; Skill &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; ActiveRecord&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;Base&lt;br /&gt; has_and_belongs_to_many &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;people&lt;br /&gt; has_many &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;people_skills&lt;font color=&quot;#990000&quot;&gt;,&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;dependent &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;destroy&lt;br /&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;end&lt;/font&gt;&lt;/strong&gt;&lt;br /&gt; &lt;br /&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;class&lt;/font&gt;&lt;/strong&gt; PeopleSkill &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; ActiveRecord&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;Base&lt;br /&gt; set_primary_key &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;not_id &lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;# int auto_increment primary key, cannot be named &#39;id&#39;&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; belongs_to &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;person&lt;br /&gt; belongs_to &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;skill&lt;br /&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;end&lt;/font&gt;&lt;/strong&gt;&lt;/pre&gt; &lt;p&gt;There 2 lines more than &lt;em&gt;rightfully necessary&lt;/em&gt;. But all the data will surely be accessible. If things turns out to be simple, your overhead is negligible. If requirements turns hairy, you&#39;re still safe! No worrying over any potential &lt;em&gt;has_many :through&lt;/em&gt; quirks, or lack of support with &lt;em&gt;has_and_belongs_to_many&lt;/em&gt;. Just go with the above setup - get some code running! - and everything can be optimised later. Wrestling more and things will begin to feel like unnecessary situps to me...&lt;/p&gt; &lt;p&gt;[Update]&lt;br /&gt; Fixed the sample code above, apparently PeopleSkill&#39;s primary key should not be named :id. So its 3 additional lines instead of 2. A tour via ./script/console will be&lt;br /&gt; &lt;/p&gt; &lt;pre&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; Person&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;delete_all&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#993399&quot;&gt;0&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; Skill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;delete_all&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#993399&quot;&gt;0&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; PeopleSkill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;delete_all&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#993399&quot;&gt;0&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; s &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt; Skill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;create &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;name &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#ff0000&quot;&gt;&amp;quot;Swimming&amp;quot;&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&amp;lt;Skill:0xb7855b3c ...&amp;gt;&amp;gt;&amp;gt;&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jack &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt; Person&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;create &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;name &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#ff0000&quot;&gt;&amp;quot;Jack&amp;quot;&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Person:0xb784da04 @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Jack&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb784b268 @errors={}, @base=#&amp;lt;Person:0xb784da04 ...&amp;gt;&amp;gt;&amp;gt;&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jill &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt; Person&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;create &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;name &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#ff0000&quot;&gt;&amp;quot;Jill&amp;quot;&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Person:0xb784181c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Jill&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;2}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb783eb30 @errors={}, @base=#&amp;lt;Person:0xb784181c ...&amp;gt;&amp;gt;&amp;gt;&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jack&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;skills &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; s&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&amp;lt;Skill:0xb7855b3c ...&amp;gt;&amp;gt;&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;skills &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; s&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&amp;lt;Skill:0xb7855b3c ...&amp;gt;&amp;gt;&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; PeopleSkill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#000000&quot;&gt;find&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;all&lt;font color=&quot;#990000&quot;&gt;)&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;PeopleSkill:0xb781206c @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;}&amp;gt;, #&amp;lt;PeopleSkill:0xb7811ef0 @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;}&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jack&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;skills &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; Skill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#000000&quot;&gt;create&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;name &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#ff0000&quot;&gt;&amp;quot;Dancing&amp;quot;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;)&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&amp;lt;Skill:0xb7855b3c ...&amp;gt;&amp;gt;&amp;gt;, #&amp;lt;Skill:0xb7809994 @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Dancing&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;2}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb7807f04 @errors={}, @base=#&amp;lt;Skill:0xb7809994 ...&amp;gt;&amp;gt;&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;skills &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; Skill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#000000&quot;&gt;create&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;name &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#ff0000&quot;&gt;&amp;quot;Cooking&amp;quot;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;)&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&amp;lt;Skill:0xb7855b3c ...&amp;gt;&amp;gt;&amp;gt;, #&amp;lt;Skill:0xb77f5930 @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Cooking&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;3}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb77f3b44 @errors={}, @base=#&amp;lt;Skill:0xb77f5930 ...&amp;gt;&amp;gt;&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jack&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#000000&quot;&gt;skills&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;(&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;true&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;)&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb77e2970 @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;}, @readonly=true&amp;gt;, #&amp;lt;Skill:0xb77e2934 @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Dancing&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;, &amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;3&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;}, @readonly=true&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jack&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;destroy&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Person:0xb784da04 @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Jack&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @skills=[], @new_record=false, @people_skills=[#&amp;lt;PeopleSkill:0xb77dce94 @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;}&amp;gt;, #&amp;lt;PeopleSkill:0xb77dcd54 @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;3&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;}&amp;gt;], @errors=#&amp;lt;ActiveRecord::Errors:0xb784b268 @errors={}, @base=#&amp;lt;Person:0xb784da04 ...&amp;gt;&amp;gt;&amp;gt;&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; PeopleSkill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#000000&quot;&gt;find&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;all&lt;font color=&quot;#990000&quot;&gt;)&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;PeopleSkill:0xb77cef88 @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;}&amp;gt;, #&amp;lt;PeopleSkill:0xb77cef38 @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;4&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;3&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;}&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; quit &lt;/pre&gt; &lt;p&gt;The reason the original sample code wasn&#39;t working was &lt;strong&gt;not&lt;/strong&gt; because of HABTM didn&#39;t create the primary key (as mentioned by Josh in the comments), but rather its precisely because it did try to include the id column in the INSERT statement (with a wrong value) thus causing primary key clashes and blah blah blah. Strangely, by changing PeopleSkill&#39;s primary key to be named something else, the INSERT statement would exclude it and insert only (`skill_id`, `person_id`), allowing MySQL to auto_generate the primary key.&lt;/p&gt; &lt;p&gt;As long as the primary keys of Person and Skill are not called &amp;quot;id&amp;quot;, PeopleSkill can happily use &amp;quot;id&amp;quot; as its auto increment primary key (as is with my original work). My force is not strong enough to attempt a patch / further investigation for this HABTM issue.&amp;nbsp;&lt;/p&gt;&lt;p&gt;[Update 2]&lt;br /&gt;Plugin available to make habtm behave: &lt;a href=&quot;../../../files/ticket5216.zip&quot;&gt;Download&lt;/a&gt; and unzip into your vendor/plugins folder.&lt;br /&gt;&lt;/p&gt;" />
<link rel="canonical" href="http://localhost:4000/weblog/2006/05/dirty-little-se.html" />
<meta property="og:url" content="http://localhost:4000/weblog/2006/05/dirty-little-se.html" />
<meta property="og:site_name" content="The Devel!" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2006-05-26T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"Dirty Little Secret","dateModified":"2006-05-26T00:00:00+08:00","datePublished":"2006-05-26T00:00:00+08:00","author":{"@type":"Person","name":"choonkeat"},"description":"I&#39;ve been doing more Rails development lately (yay!) but have something shameful to admit: &lt;blockquote&gt; &lt;p&gt; I don&#39;t care what &lt;a href=&quot;http://blog.hasmanythrough.com/articles/2006/04/20/many-to-many-dance-off&quot;&gt;variant of many-to-many relationship&lt;/a&gt; the models have, I bulldoze with a same implementation everytime. &lt;/p&gt; &lt;/blockquote&gt; &lt;p&gt;The &lt;a href=&quot;http://blog.hasmanythrough.com/articles/category/associations&quot;&gt;nuances and gotchas&lt;/a&gt; are too much for my liking. So rather than spending time groking them and risk &lt;a href=&quot;http://dev.rubyonrails.org/changeset/4123&quot;&gt;seeing them deprecated&lt;/a&gt; (not complaining, just note things are moving fast), I&#39;d prefer to rely on simpler concepts which are hence more stable and has &lt;a href=&quot;http://www.artima.com/intv/ruby4.html&quot;&gt;least-surprise&lt;/a&gt; behaviors. Use the time saved to think about real important stuff: business requirements.&lt;br /&gt; &lt;/p&gt; &lt;p&gt;Simplifying the concept will mean a tiny bit more code - but lesser wrestling with the framework overall, IMHO. To represent any many-to-many relationship, opt for a rich-association database setup everytime (aka include an auto_increment id in the join table), regardless of whether there&#39;ll ultimately be extra attributes. Defer decisions. Hence, &lt;em&gt;people.id == people_skills.person_id and&amp;nbsp; people_skills.skill_id == skills.id&lt;/em&gt; in the database will be represented in ActiveRecord as:&lt;br /&gt; &lt;/p&gt; &lt;pre&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;class&lt;/font&gt;&lt;/strong&gt; Person &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; ActiveRecord&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;Base&lt;br /&gt; has_and_belongs_to_many &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;skills&lt;br /&gt; has_many &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;people_skills&lt;font color=&quot;#990000&quot;&gt;,&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;dependent &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;destroy&lt;br /&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;end&lt;/font&gt;&lt;/strong&gt;&lt;br /&gt; &lt;br /&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;class&lt;/font&gt;&lt;/strong&gt; Skill &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; ActiveRecord&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;Base&lt;br /&gt; has_and_belongs_to_many &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;people&lt;br /&gt; has_many &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;people_skills&lt;font color=&quot;#990000&quot;&gt;,&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;dependent &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;destroy&lt;br /&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;end&lt;/font&gt;&lt;/strong&gt;&lt;br /&gt; &lt;br /&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;class&lt;/font&gt;&lt;/strong&gt; PeopleSkill &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; ActiveRecord&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;Base&lt;br /&gt; set_primary_key &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;not_id &lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;# int auto_increment primary key, cannot be named &#39;id&#39;&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; belongs_to &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;person&lt;br /&gt; belongs_to &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;skill&lt;br /&gt; &lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;end&lt;/font&gt;&lt;/strong&gt;&lt;/pre&gt; &lt;p&gt;There 2 lines more than &lt;em&gt;rightfully necessary&lt;/em&gt;. But all the data will surely be accessible. If things turns out to be simple, your overhead is negligible. If requirements turns hairy, you&#39;re still safe! No worrying over any potential &lt;em&gt;has_many :through&lt;/em&gt; quirks, or lack of support with &lt;em&gt;has_and_belongs_to_many&lt;/em&gt;. Just go with the above setup - get some code running! - and everything can be optimised later. Wrestling more and things will begin to feel like unnecessary situps to me...&lt;/p&gt; &lt;p&gt;[Update]&lt;br /&gt; Fixed the sample code above, apparently PeopleSkill&#39;s primary key should not be named :id. So its 3 additional lines instead of 2. A tour via ./script/console will be&lt;br /&gt; &lt;/p&gt; &lt;pre&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; Person&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;delete_all&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#993399&quot;&gt;0&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; Skill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;delete_all&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#993399&quot;&gt;0&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; PeopleSkill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;delete_all&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#993399&quot;&gt;0&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; s &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt; Skill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;create &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;name &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#ff0000&quot;&gt;&amp;quot;Swimming&amp;quot;&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&amp;lt;Skill:0xb7855b3c ...&amp;gt;&amp;gt;&amp;gt;&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jack &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt; Person&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;create &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;name &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#ff0000&quot;&gt;&amp;quot;Jack&amp;quot;&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Person:0xb784da04 @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Jack&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb784b268 @errors={}, @base=#&amp;lt;Person:0xb784da04 ...&amp;gt;&amp;gt;&amp;gt;&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jill &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt; Person&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;create &lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;name &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#ff0000&quot;&gt;&amp;quot;Jill&amp;quot;&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Person:0xb784181c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Jill&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;2}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb783eb30 @errors={}, @base=#&amp;lt;Person:0xb784181c ...&amp;gt;&amp;gt;&amp;gt;&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jack&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;skills &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; s&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&amp;lt;Skill:0xb7855b3c ...&amp;gt;&amp;gt;&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;skills &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; s&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&amp;lt;Skill:0xb7855b3c ...&amp;gt;&amp;gt;&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; PeopleSkill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#000000&quot;&gt;find&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;all&lt;font color=&quot;#990000&quot;&gt;)&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;PeopleSkill:0xb781206c @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;}&amp;gt;, #&amp;lt;PeopleSkill:0xb7811ef0 @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;}&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jack&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;skills &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; Skill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#000000&quot;&gt;create&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;name &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#ff0000&quot;&gt;&amp;quot;Dancing&amp;quot;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;)&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&amp;lt;Skill:0xb7855b3c ...&amp;gt;&amp;gt;&amp;gt;, #&amp;lt;Skill:0xb7809994 @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Dancing&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;2}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb7807f04 @errors={}, @base=#&amp;lt;Skill:0xb7809994 ...&amp;gt;&amp;gt;&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;skills &lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;lt;&lt;/font&gt; Skill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#000000&quot;&gt;create&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;name &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#ff0000&quot;&gt;&amp;quot;Cooking&amp;quot;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;)&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&amp;lt;Skill:0xb7855b3c ...&amp;gt;&amp;gt;&amp;gt;, #&amp;lt;Skill:0xb77f5930 @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Cooking&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;3}, @new_record=false, @errors=#&amp;lt;ActiveRecord::Errors:0xb77f3b44 @errors={}, @base=#&amp;lt;Skill:0xb77f5930 ...&amp;gt;&amp;gt;&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jack&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#000000&quot;&gt;skills&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;(&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#0000ff&quot;&gt;true&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;)&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Skill:0xb77e2970 @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Swimming&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;}, @readonly=true&amp;gt;, #&amp;lt;Skill:0xb77e2934 @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Dancing&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;, &amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;3&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;}, @readonly=true&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; jack&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;destroy&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;Person:0xb784da04 @new_record_before_save=true, @attributes={&amp;quot;name&amp;quot;=&amp;gt;&amp;quot;Jack&amp;quot;, &amp;quot;id&amp;quot;=&amp;gt;1}, @skills=[], @new_record=false, @people_skills=[#&amp;lt;PeopleSkill:0xb77dce94 @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;}&amp;gt;, #&amp;lt;PeopleSkill:0xb77dcd54 @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;3&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;}&amp;gt;], @errors=#&amp;lt;ActiveRecord::Errors:0xb784b268 @errors={}, @base=#&amp;lt;Person:0xb784da04 ...&amp;gt;&amp;gt;&amp;gt;&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; PeopleSkill&lt;font color=&quot;#990000&quot;&gt;.&lt;/font&gt;&lt;strong&gt;&lt;font color=&quot;#000000&quot;&gt;find&lt;/font&gt;&lt;/strong&gt;&lt;font color=&quot;#990000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;:&lt;/font&gt;all&lt;font color=&quot;#990000&quot;&gt;)&lt;/font&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;=&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; &lt;font color=&quot;#990000&quot;&gt;[&lt;/font&gt;&lt;em&gt;&lt;font color=&quot;#9a1900&quot;&gt;#&amp;lt;PeopleSkill:0xb77cef88 @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;1&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;}&amp;gt;, #&amp;lt;PeopleSkill:0xb77cef38 @attributes={&amp;quot;not_id&amp;quot;=&amp;gt;&amp;quot;4&amp;quot;, &amp;quot;skill_id&amp;quot;=&amp;gt;&amp;quot;3&amp;quot;, &amp;quot;person_id&amp;quot;=&amp;gt;&amp;quot;2&amp;quot;}&amp;gt;]&lt;/font&gt;&lt;/em&gt;&lt;br /&gt; &lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt;&lt;font color=&quot;#990000&quot;&gt;&amp;gt;&lt;/font&gt; quit &lt;/pre&gt; &lt;p&gt;The reason the original sample code wasn&#39;t working was &lt;strong&gt;not&lt;/strong&gt; because of HABTM didn&#39;t create the primary key (as mentioned by Josh in the comments), but rather its precisely because it did try to include the id column in the INSERT statement (with a wrong value) thus causing primary key clashes and blah blah blah. Strangely, by changing PeopleSkill&#39;s primary key to be named something else, the INSERT statement would exclude it and insert only (`skill_id`, `person_id`), allowing MySQL to auto_generate the primary key.&lt;/p&gt; &lt;p&gt;As long as the primary keys of Person and Skill are not called &amp;quot;id&amp;quot;, PeopleSkill can happily use &amp;quot;id&amp;quot; as its auto increment primary key (as is with my original work). My force is not strong enough to attempt a patch / further investigation for this HABTM issue.&amp;nbsp;&lt;/p&gt;&lt;p&gt;[Update 2]&lt;br /&gt;Plugin available to make habtm behave: &lt;a href=&quot;../../../files/ticket5216.zip&quot;&gt;Download&lt;/a&gt; and unzip into your vendor/plugins folder.&lt;br /&gt;&lt;/p&gt;","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/weblog/2006/05/dirty-little-se.html"},"url":"http://localhost:4000/weblog/2006/05/dirty-little-se.html","@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="The Devel!" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">The Devel!</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Dirty Little Secret</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2006-05-26T00:00:00+08:00" itemprop="datePublished">May 26, 2006
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I've been doing more Rails development lately (yay!) but have something shameful to admit:</p>       <blockquote>    <p> I don't care what <a href="http://blog.hasmanythrough.com/articles/2006/04/20/many-to-many-dance-off">variant of many-to-many relationship</a> the models have, I bulldoze with a same implementation everytime. </p>    </blockquote>        <p>The <a href="http://blog.hasmanythrough.com/articles/category/associations">nuances and gotchas</a> are too much for my liking. So rather than spending time groking them and risk <a href="http://dev.rubyonrails.org/changeset/4123">seeing them deprecated</a> (not complaining, just note things are moving fast), I'd prefer to rely on simpler concepts which are hence more stable and has <a href="http://www.artima.com/intv/ruby4.html">least-surprise</a> behaviors. Use the time saved to think about real important stuff: business requirements.<br />     </p>         <p>Simplifying the concept will mean a tiny bit more code - but lesser wrestling with the framework overall, IMHO. To represent any many-to-many relationship, opt for a rich-association database setup everytime (aka include an auto_increment id in the join table), regardless of whether there'll ultimately be extra attributes. Defer decisions. Hence, <em>people.id == people_skills.person_id and&nbsp; people_skills.skill_id == skills.id</em> in the database will be represented in ActiveRecord as:<br />     </p>         <pre>  <strong><font color="#0000ff">class</font></strong> Person <font color="#990000">&lt;</font> ActiveRecord<font color="#990000">:</font><font color="#990000">:</font>Base<br />     has_and_belongs_to_many <font color="#990000">:</font>skills<br />     has_many <font color="#990000">:</font>people_skills<font color="#990000">,</font> <font color="#990000">:</font>dependent <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#990000">:</font>destroy<br />   <strong><font color="#0000ff">end</font></strong><br />   <br />   <strong><font color="#0000ff">class</font></strong> Skill <font color="#990000">&lt;</font> ActiveRecord<font color="#990000">:</font><font color="#990000">:</font>Base<br />     has_and_belongs_to_many <font color="#990000">:</font>people<br />     has_many <font color="#990000">:</font>people_skills<font color="#990000">,</font> <font color="#990000">:</font>dependent <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#990000">:</font>destroy<br />   <strong><font color="#0000ff">end</font></strong><br />   <br />   <strong><font color="#0000ff">class</font></strong> PeopleSkill <font color="#990000">&lt;</font> ActiveRecord<font color="#990000">:</font><font color="#990000">:</font>Base<br />     set_primary_key <font color="#990000">:</font>not_id <em><font color="#9a1900"># int auto_increment primary key, cannot be named 'id'</font></em><br />     belongs_to <font color="#990000">:</font>person<br />     belongs_to <font color="#990000">:</font>skill<br />   <strong><font color="#0000ff">end</font></strong></pre>         <p>There 2 lines more than <em>rightfully necessary</em>. But all the data will surely be accessible. If things turns out to be simple, your overhead is negligible. If requirements turns hairy, you're still safe! No worrying over any potential <em>has_many :through</em> quirks, or lack of support with <em>has_and_belongs_to_many</em>. Just go with the above setup - get some code running! - and everything can be optimised later. Wrestling more and things will begin to feel like unnecessary situps to me...</p>     <p>[Update]<br />   Fixed the sample code above, apparently PeopleSkill's primary key should not be named :id. So its 3 additional lines instead of 2. A tour via ./script/console will be<br />   </p>     <pre>  <font color="#990000">&gt;</font><font color="#990000">&gt;</font> Person<font color="#990000">.</font>delete_all<br />   <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#993399">0</font><br />   <font color="#990000">&gt;</font><font color="#990000">&gt;</font> Skill<font color="#990000">.</font>delete_all<br />   <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#993399">0</font><br />   <font color="#990000">&gt;</font><font color="#990000">&gt;</font> PeopleSkill<font color="#990000">.</font>delete_all<br />   <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#993399">0</font><br />   <font color="#990000">&gt;</font><font color="#990000">&gt;</font> s <font color="#990000">=</font> Skill<font color="#990000">.</font>create <font color="#990000">:</font>name <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#ff0000">&quot;Swimming&quot;</font><br />   <font color="#990000">=</font><font color="#990000">&gt;</font> <em><font color="#9a1900">#&lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&quot;name&quot;=&gt;&quot;Swimming&quot;, &quot;id&quot;=&gt;1}, @new_record=false, @errors=#&lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&lt;Skill:0xb7855b3c ...&gt;&gt;&gt;</font></em><br />   <font color="#990000">&gt;</font><font color="#990000">&gt;</font> jack <font color="#990000">=</font> Person<font color="#990000">.</font>create <font color="#990000">:</font>name <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#ff0000">&quot;Jack&quot;</font><br />   <font color="#990000">=</font><font color="#990000">&gt;</font> <em><font color="#9a1900">#&lt;Person:0xb784da04 @new_record_before_save=true, @attributes={&quot;name&quot;=&gt;&quot;Jack&quot;, &quot;id&quot;=&gt;1}, @new_record=false, @errors=#&lt;ActiveRecord::Errors:0xb784b268 @errors={}, @base=#&lt;Person:0xb784da04 ...&gt;&gt;&gt;</font></em><br />   <font color="#990000">&gt;</font><font color="#990000">&gt;</font> jill <font color="#990000">=</font> Person<font color="#990000">.</font>create <font color="#990000">:</font>name <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#ff0000">&quot;Jill&quot;</font><br />   <font color="#990000">=</font><font color="#990000">&gt;</font> <em><font color="#9a1900">#&lt;Person:0xb784181c @new_record_before_save=true, @attributes={&quot;name&quot;=&gt;&quot;Jill&quot;, &quot;id&quot;=&gt;2}, @new_record=false, @errors=#&lt;ActiveRecord::Errors:0xb783eb30 @errors={}, @base=#&lt;Person:0xb784181c ...&gt;&gt;&gt;</font></em><br />   <font color="#990000">&gt;</font><font color="#990000">&gt;</font> jack<font color="#990000">.</font>skills <font color="#990000">&lt;</font><font color="#990000">&lt;</font> s<br />   <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#990000">[</font><em><font color="#9a1900">#&lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&quot;name&quot;=&gt;&quot;Swimming&quot;, &quot;id&quot;=&gt;1}, @new_record=false, @errors=#&lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&lt;Skill:0xb7855b3c ...&gt;&gt;&gt;]</font></em><br />   <font color="#990000">&gt;</font><font color="#990000">&gt;</font> jill<font color="#990000">.</font>skills <font color="#990000">&lt;</font><font color="#990000">&lt;</font> s<br />   <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#990000">[</font><em><font color="#9a1900">#&lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&quot;name&quot;=&gt;&quot;Swimming&quot;, &quot;id&quot;=&gt;1}, @new_record=false, @errors=#&lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&lt;Skill:0xb7855b3c ...&gt;&gt;&gt;]</font></em><br />   <font color="#990000">&gt;</font><font color="#990000">&gt;</font> PeopleSkill<font color="#990000">.</font><strong><font color="#000000">find</font></strong><font color="#990000">(</font><font color="#990000">:</font>all<font color="#990000">)</font><br />   <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#990000">[</font><em><font color="#9a1900">#&lt;PeopleSkill:0xb781206c @attributes={&quot;not_id&quot;=&gt;&quot;1&quot;, &quot;skill_id&quot;=&gt;&quot;1&quot;, &quot;person_id&quot;=&gt;&quot;1&quot;}&gt;, #&lt;PeopleSkill:0xb7811ef0 @attributes={&quot;not_id&quot;=&gt;&quot;2&quot;, &quot;skill_id&quot;=&gt;&quot;1&quot;, &quot;person_id&quot;=&gt;&quot;2&quot;}&gt;]</font></em><br />   <font color="#990000">&gt;</font><font color="#990000">&gt;</font> jack<font color="#990000">.</font>skills <font color="#990000">&lt;</font><font color="#990000">&lt;</font> Skill<font color="#990000">.</font><strong><font color="#000000">create</font></strong><font color="#990000">(</font><font color="#990000">:</font>name <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#ff0000">&quot;Dancing&quot;</font><font color="#990000">)</font><br />   <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#990000">[</font><em><font color="#9a1900">#&lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&quot;name&quot;=&gt;&quot;Swimming&quot;, &quot;id&quot;=&gt;1}, @new_record=false, @errors=#&lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&lt;Skill:0xb7855b3c ...&gt;&gt;&gt;, #&lt;Skill:0xb7809994 @new_record_before_save=true, @attributes={&quot;name&quot;=&gt;&quot;Dancing&quot;, &quot;id&quot;=&gt;2}, @new_record=false, @errors=#&lt;ActiveRecord::Errors:0xb7807f04 @errors={}, @base=#&lt;Skill:0xb7809994 ...&gt;&gt;&gt;]</font></em><br />   <font color="#990000">&gt;</font><font color="#990000">&gt;</font> jill<font color="#990000">.</font>skills <font color="#990000">&lt;</font><font color="#990000">&lt;</font> Skill<font color="#990000">.</font><strong><font color="#000000">create</font></strong><font color="#990000">(</font><font color="#990000">:</font>name <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#ff0000">&quot;Cooking&quot;</font><font color="#990000">)</font><br />   <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#990000">[</font><em><font color="#9a1900">#&lt;Skill:0xb7855b3c @new_record_before_save=true, @attributes={&quot;name&quot;=&gt;&quot;Swimming&quot;, &quot;id&quot;=&gt;1}, @new_record=false, @errors=#&lt;ActiveRecord::Errors:0xb78533a0 @errors={}, @base=#&lt;Skill:0xb7855b3c ...&gt;&gt;&gt;, #&lt;Skill:0xb77f5930 @new_record_before_save=true, @attributes={&quot;name&quot;=&gt;&quot;Cooking&quot;, &quot;id&quot;=&gt;3}, @new_record=false, @errors=#&lt;ActiveRecord::Errors:0xb77f3b44 @errors={}, @base=#&lt;Skill:0xb77f5930 ...&gt;&gt;&gt;]</font></em><br />   <font color="#990000">&gt;</font><font color="#990000">&gt;</font> jack<font color="#990000">.</font><strong><font color="#000000">skills</font></strong><font color="#990000">(</font><strong><font color="#0000ff">true</font></strong><font color="#990000">)</font><br />   <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#990000">[</font><em><font color="#9a1900">#&lt;Skill:0xb77e2970 @attributes={&quot;name&quot;=&gt;&quot;Swimming&quot;, &quot;id&quot;=&gt;&quot;1&quot;, &quot;not_id&quot;=&gt;&quot;1&quot;, &quot;skill_id&quot;=&gt;&quot;1&quot;, &quot;person_id&quot;=&gt;&quot;1&quot;}, @readonly=true&gt;, #&lt;Skill:0xb77e2934 @attributes={&quot;name&quot;=&gt;&quot;Dancing&quot;, &quot;id&quot;=&gt;&quot;2&quot;, &quot;not_id&quot;=&gt;&quot;3&quot;, &quot;skill_id&quot;=&gt;&quot;2&quot;, &quot;person_id&quot;=&gt;&quot;1&quot;}, @readonly=true&gt;]</font></em><br />   <font color="#990000">&gt;</font><font color="#990000">&gt;</font> jack<font color="#990000">.</font>destroy<br />   <font color="#990000">=</font><font color="#990000">&gt;</font> <em><font color="#9a1900">#&lt;Person:0xb784da04 @new_record_before_save=true, @attributes={&quot;name&quot;=&gt;&quot;Jack&quot;, &quot;id&quot;=&gt;1}, @skills=[], @new_record=false, @people_skills=[#&lt;PeopleSkill:0xb77dce94 @attributes={&quot;not_id&quot;=&gt;&quot;1&quot;, &quot;skill_id&quot;=&gt;&quot;1&quot;, &quot;person_id&quot;=&gt;&quot;1&quot;}&gt;, #&lt;PeopleSkill:0xb77dcd54 @attributes={&quot;not_id&quot;=&gt;&quot;3&quot;, &quot;skill_id&quot;=&gt;&quot;2&quot;, &quot;person_id&quot;=&gt;&quot;1&quot;}&gt;], @errors=#&lt;ActiveRecord::Errors:0xb784b268 @errors={}, @base=#&lt;Person:0xb784da04 ...&gt;&gt;&gt;</font></em><br />   <font color="#990000">&gt;</font><font color="#990000">&gt;</font> PeopleSkill<font color="#990000">.</font><strong><font color="#000000">find</font></strong><font color="#990000">(</font><font color="#990000">:</font>all<font color="#990000">)</font><br />   <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#990000">[</font><em><font color="#9a1900">#&lt;PeopleSkill:0xb77cef88 @attributes={&quot;not_id&quot;=&gt;&quot;2&quot;, &quot;skill_id&quot;=&gt;&quot;1&quot;, &quot;person_id&quot;=&gt;&quot;2&quot;}&gt;, #&lt;PeopleSkill:0xb77cef38 @attributes={&quot;not_id&quot;=&gt;&quot;4&quot;, &quot;skill_id&quot;=&gt;&quot;3&quot;, &quot;person_id&quot;=&gt;&quot;2&quot;}&gt;]</font></em><br />   <font color="#990000">&gt;</font><font color="#990000">&gt;</font> quit </pre>     <p>The reason the original sample code wasn't working was <strong>not</strong> because of HABTM didn't create the primary key (as mentioned by Josh in the comments), but rather its precisely because it did try to include the id column in the INSERT statement (with a wrong value) thus causing primary key clashes and blah blah blah. Strangely, by changing PeopleSkill's primary key to be named something else, the INSERT statement would exclude it and insert only (`skill_id`, `person_id`), allowing MySQL to auto_generate the primary key.</p>   <p>As long as the primary keys of Person and Skill are not called &quot;id&quot;, PeopleSkill can happily use &quot;id&quot; as its auto increment primary key (as is with my original work). My force is not strong enough to attempt a patch / further investigation for this HABTM issue.&nbsp;</p><p>[Update 2]<br />Plugin available to make habtm behave: <a href="../../../files/ticket5216.zip">Download</a> and unzip into your vendor/plugins folder.<br /></p>


  </div><a class="u-url" href="/weblog/2006/05/dirty-little-se.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">The Devel!</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">choonkeat</li><li><a class="u-email" href="mailto:contactme@choonkeat.com">contactme@choonkeat.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/choonkeat"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">choonkeat</span></a></li><li><a href="https://www.twitter.com/choonkeat"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">choonkeat</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>choonkeat on programming &amp; software</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
