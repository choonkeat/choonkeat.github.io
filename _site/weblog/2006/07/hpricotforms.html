<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.5.0 -->
<title>HpricotForms | The Devel!</title>
<meta name="generator" content="Jekyll v3.8.3" />
<meta property="og:title" content="HpricotForms" />
<meta name="author" content="choonkeat" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Since the introduction of Hpricot, the snazzy and fast Ruby parser for HTML, I&#39;ve been meaning to give it a whirl - the API looks yummy. Now, as I&#39;m doing more testing and validation stuff at work, such a need has come. Back in Javaland, when I need to navigate or test web apps by code, submit forms and do other web bot stuff, I turn to HtmlUnit. The api is simply awesome and won me over immediately. So if you&#39;re still stuck in Java, do give it a look. Anyways, though the whole testing harness of Rails is a godsend, I started to miss some of those HtmlUnit goodies - pulling out a Form object from a visited page, setting the fields values and submitting it.. and getting back a Page. So, this is what I&#39;ve come up with for use in functional tests: def test_login_logout page = get :new # first, let&#39;s get to the login page form = page.forms.first # next, get a reference to the form # form.field_names =&gt; [&quot;user[login]&quot;, &quot;user[password]&quot;] # form.field_names returns you the input fields # available in the form form[&quot;user[login]&quot;] = &quot;Joe&quot; form[&quot;user[password]&quot;] = &quot;topsecret&quot; page = form.submit(self) # after setting the form values, submit it # &#39;page&#39; now references the page after login assert_response :success # page.links # returns you an array of links found on the page page = page.links(&quot;@id=&#39;signout&#39;&quot;).click(self) # locate the sign-out link by its html id # and click it assert_response :success end Can&#39;t say its a replica of HtmlUnit... but it does meet my needs for now. Notice we didn&#39;t need to explicitly handle things like session or where the form submits to. It simply goes to where its supposed to go - as rendered by the view. And yes, as you do submit() and click() you might actually cross different controllers. HpricotForms handles that for you. The main thing I like about this API is that the field names in the form are real. If you&#39;re careless like me, and modify your action templates (.rhtml files) but forgot to change both your controller and test, traditionally your test will still pass because you were passing in parameters explicitly, e.g. post :login, {:user =&gt; {:login =&gt; &quot;Joe&quot;, :password =&gt; &quot;topsecret&quot;}} even though your HTML form fields were changed to &quot;account[login]&quot; and &quot;account[passwd]&quot;. But HpricotForms will raise an exception when you try to set values into fields that does not exist in the rendered form. HpricotForms doesn&#39;t add new assert_xxx methods to your test environment since I personally think we&#39;ve had enough already. It merely deals with navigation. I&#39;m sure programmers out there are capable enough to do their own assertions when they need it. script/plugin install http://choonkeat.svnrepository.com/svn/rails-plugins/hpricot_forms Note: It appears that HpricotForms only work on Edge Rails, with simply_restful plugin. This is due to the routing changes. Works with Rails 1.1.4 and Edge Rails. Feedback is welcome. Update Added form.extend!(partial) to allow extending the formfields &nbsp;with a separate HTTP request. i.e. if your form appends fields via xmlHttpRequest, you can now say form = page.forms.firstform.field_names # =&gt; [&quot;email[0]&quot;] # the original form only has 1 fieldform[&quot;email[0]&quot;] = &quot;email1&quot;form.extend!(get :on_security_options_clicked) do form.field_names # =&gt; [&quot;email[0]&quot;, &quot;ssl&quot;] # the new fields from the partial is # appended into our form object. form[&quot;ssl&quot;] = &quot;true&quot;endpage = form.submit(self) # the combined form will be submitted Also, to help kick off the writing of code, form.to_code will print out a series of variable assignment satements based on the default values from the form, e.g. form = page.forms.firstputs form.to_code # this prints lines of Ruby code like:# # form[&quot;from&quot;] = &quot;sender&quot;# form[&quot;email[0]&quot;] = &quot;email1&quot; # form[&quot;options[]&quot;] = [&quot;html&quot;, &quot;read-receipt&quot;]" />
<meta property="og:description" content="Since the introduction of Hpricot, the snazzy and fast Ruby parser for HTML, I&#39;ve been meaning to give it a whirl - the API looks yummy. Now, as I&#39;m doing more testing and validation stuff at work, such a need has come. Back in Javaland, when I need to navigate or test web apps by code, submit forms and do other web bot stuff, I turn to HtmlUnit. The api is simply awesome and won me over immediately. So if you&#39;re still stuck in Java, do give it a look. Anyways, though the whole testing harness of Rails is a godsend, I started to miss some of those HtmlUnit goodies - pulling out a Form object from a visited page, setting the fields values and submitting it.. and getting back a Page. So, this is what I&#39;ve come up with for use in functional tests: def test_login_logout page = get :new # first, let&#39;s get to the login page form = page.forms.first # next, get a reference to the form # form.field_names =&gt; [&quot;user[login]&quot;, &quot;user[password]&quot;] # form.field_names returns you the input fields # available in the form form[&quot;user[login]&quot;] = &quot;Joe&quot; form[&quot;user[password]&quot;] = &quot;topsecret&quot; page = form.submit(self) # after setting the form values, submit it # &#39;page&#39; now references the page after login assert_response :success # page.links # returns you an array of links found on the page page = page.links(&quot;@id=&#39;signout&#39;&quot;).click(self) # locate the sign-out link by its html id # and click it assert_response :success end Can&#39;t say its a replica of HtmlUnit... but it does meet my needs for now. Notice we didn&#39;t need to explicitly handle things like session or where the form submits to. It simply goes to where its supposed to go - as rendered by the view. And yes, as you do submit() and click() you might actually cross different controllers. HpricotForms handles that for you. The main thing I like about this API is that the field names in the form are real. If you&#39;re careless like me, and modify your action templates (.rhtml files) but forgot to change both your controller and test, traditionally your test will still pass because you were passing in parameters explicitly, e.g. post :login, {:user =&gt; {:login =&gt; &quot;Joe&quot;, :password =&gt; &quot;topsecret&quot;}} even though your HTML form fields were changed to &quot;account[login]&quot; and &quot;account[passwd]&quot;. But HpricotForms will raise an exception when you try to set values into fields that does not exist in the rendered form. HpricotForms doesn&#39;t add new assert_xxx methods to your test environment since I personally think we&#39;ve had enough already. It merely deals with navigation. I&#39;m sure programmers out there are capable enough to do their own assertions when they need it. script/plugin install http://choonkeat.svnrepository.com/svn/rails-plugins/hpricot_forms Note: It appears that HpricotForms only work on Edge Rails, with simply_restful plugin. This is due to the routing changes. Works with Rails 1.1.4 and Edge Rails. Feedback is welcome. Update Added form.extend!(partial) to allow extending the formfields &nbsp;with a separate HTTP request. i.e. if your form appends fields via xmlHttpRequest, you can now say form = page.forms.firstform.field_names # =&gt; [&quot;email[0]&quot;] # the original form only has 1 fieldform[&quot;email[0]&quot;] = &quot;email1&quot;form.extend!(get :on_security_options_clicked) do form.field_names # =&gt; [&quot;email[0]&quot;, &quot;ssl&quot;] # the new fields from the partial is # appended into our form object. form[&quot;ssl&quot;] = &quot;true&quot;endpage = form.submit(self) # the combined form will be submitted Also, to help kick off the writing of code, form.to_code will print out a series of variable assignment satements based on the default values from the form, e.g. form = page.forms.firstputs form.to_code # this prints lines of Ruby code like:# # form[&quot;from&quot;] = &quot;sender&quot;# form[&quot;email[0]&quot;] = &quot;email1&quot; # form[&quot;options[]&quot;] = [&quot;html&quot;, &quot;read-receipt&quot;]" />
<link rel="canonical" href="http://localhost:4000/weblog/2006/07/hpricotforms.html" />
<meta property="og:url" content="http://localhost:4000/weblog/2006/07/hpricotforms.html" />
<meta property="og:site_name" content="The Devel!" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2006-07-19T00:00:00+08:00" />
<script type="application/ld+json">
{"headline":"HpricotForms","dateModified":"2006-07-19T00:00:00+08:00","datePublished":"2006-07-19T00:00:00+08:00","author":{"@type":"Person","name":"choonkeat"},"description":"Since the introduction of Hpricot, the snazzy and fast Ruby parser for HTML, I&#39;ve been meaning to give it a whirl - the API looks yummy. Now, as I&#39;m doing more testing and validation stuff at work, such a need has come. Back in Javaland, when I need to navigate or test web apps by code, submit forms and do other web bot stuff, I turn to HtmlUnit. The api is simply awesome and won me over immediately. So if you&#39;re still stuck in Java, do give it a look. Anyways, though the whole testing harness of Rails is a godsend, I started to miss some of those HtmlUnit goodies - pulling out a Form object from a visited page, setting the fields values and submitting it.. and getting back a Page. So, this is what I&#39;ve come up with for use in functional tests: def test_login_logout page = get :new # first, let&#39;s get to the login page form = page.forms.first # next, get a reference to the form # form.field_names =&gt; [&quot;user[login]&quot;, &quot;user[password]&quot;] # form.field_names returns you the input fields # available in the form form[&quot;user[login]&quot;] = &quot;Joe&quot; form[&quot;user[password]&quot;] = &quot;topsecret&quot; page = form.submit(self) # after setting the form values, submit it # &#39;page&#39; now references the page after login assert_response :success # page.links # returns you an array of links found on the page page = page.links(&quot;@id=&#39;signout&#39;&quot;).click(self) # locate the sign-out link by its html id # and click it assert_response :success end Can&#39;t say its a replica of HtmlUnit... but it does meet my needs for now. Notice we didn&#39;t need to explicitly handle things like session or where the form submits to. It simply goes to where its supposed to go - as rendered by the view. And yes, as you do submit() and click() you might actually cross different controllers. HpricotForms handles that for you. The main thing I like about this API is that the field names in the form are real. If you&#39;re careless like me, and modify your action templates (.rhtml files) but forgot to change both your controller and test, traditionally your test will still pass because you were passing in parameters explicitly, e.g. post :login, {:user =&gt; {:login =&gt; &quot;Joe&quot;, :password =&gt; &quot;topsecret&quot;}} even though your HTML form fields were changed to &quot;account[login]&quot; and &quot;account[passwd]&quot;. But HpricotForms will raise an exception when you try to set values into fields that does not exist in the rendered form. HpricotForms doesn&#39;t add new assert_xxx methods to your test environment since I personally think we&#39;ve had enough already. It merely deals with navigation. I&#39;m sure programmers out there are capable enough to do their own assertions when they need it. script/plugin install http://choonkeat.svnrepository.com/svn/rails-plugins/hpricot_forms Note: It appears that HpricotForms only work on Edge Rails, with simply_restful plugin. This is due to the routing changes. Works with Rails 1.1.4 and Edge Rails. Feedback is welcome. Update Added form.extend!(partial) to allow extending the formfields &nbsp;with a separate HTTP request. i.e. if your form appends fields via xmlHttpRequest, you can now say form = page.forms.firstform.field_names # =&gt; [&quot;email[0]&quot;] # the original form only has 1 fieldform[&quot;email[0]&quot;] = &quot;email1&quot;form.extend!(get :on_security_options_clicked) do form.field_names # =&gt; [&quot;email[0]&quot;, &quot;ssl&quot;] # the new fields from the partial is # appended into our form object. form[&quot;ssl&quot;] = &quot;true&quot;endpage = form.submit(self) # the combined form will be submitted Also, to help kick off the writing of code, form.to_code will print out a series of variable assignment satements based on the default values from the form, e.g. form = page.forms.firstputs form.to_code # this prints lines of Ruby code like:# # form[&quot;from&quot;] = &quot;sender&quot;# form[&quot;email[0]&quot;] = &quot;email1&quot; # form[&quot;options[]&quot;] = [&quot;html&quot;, &quot;read-receipt&quot;]","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/weblog/2006/07/hpricotforms.html"},"url":"http://localhost:4000/weblog/2006/07/hpricotforms.html","@type":"BlogPosting","@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="The Devel!" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">The Devel!</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">HpricotForms</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2006-07-19T00:00:00+08:00" itemprop="datePublished">Jul 19, 2006
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>Since the introduction of <a href="http://redhanded.hobix.com/inspect/hpricot01.html">Hpricot</a>, the snazzy and fast Ruby parser for HTML, I've been meaning to give it a whirl - the API looks yummy. Now, as I'm doing more testing and validation stuff at work, such a need has come. Back in Javaland, when I need to navigate or test web apps by code, submit forms and do other web bot stuff, I turn to <a href="http://htmlunit.sourceforge.net/gettingStarted.html">HtmlUnit</a>. The api is simply awesome and won me over immediately. So if you're still stuck in Java, do give it a look.</p> <p>Anyways, though the whole testing harness of Rails is a godsend, I started to miss some of those HtmlUnit goodies - pulling out a Form object from a visited page, setting the fields values and submitting it.. and getting back a Page. So, this is what I've come up with for use in functional tests:<br /> </p> <pre><span class="keyword">def </span><span class="method">test_login_logout</span><br />   <span class="ident">page</span> <span class="punct">=</span> <span class="ident">get</span> <span class="symbol">:new</span>            <span class="comment"># first, let's get to the login page</span><br />   <span class="ident">form</span> <span class="punct">=</span> <span class="ident">page</span><span class="punct">.</span><span class="ident">forms</span><span class="punct">.</span><span class="ident">first</span>    <span class="comment"># next, get a reference to the form</span><br />   <span class="comment"># form.field_names =&gt; [&quot;user[login]&quot;, &quot;user[password]&quot;]</span><br />                              <span class="comment"># form.field_names returns you the input fields</span><br />                              <span class="comment"># available in the form</span><br /> <br />   <span class="ident">form</span><span class="punct">[&quot;</span><span class="string">user[login]</span><span class="punct">&quot;]</span>    <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">Joe</span><span class="punct">&quot;</span><br />   <span class="ident">form</span><span class="punct">[&quot;</span><span class="string">user[password]</span><span class="punct">&quot;]</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">topsecret</span><span class="punct">&quot;</span><br />   <span class="ident">page</span> <span class="punct">=</span> <span class="ident">form</span><span class="punct">.</span><span class="ident">submit</span><span class="punct">(</span><span class="constant">self</span><span class="punct">)</span>   <span class="comment"># after setting the form values, submit it</span><br />                              <span class="comment"># 'page' now references the page after login</span><br />   <span class="ident">assert_response</span> <span class="symbol">:success</span><br />   <span class="comment"># page.links               # returns you an array of links found on the page</span><br /> <br />   <span class="ident">page</span> <span class="punct">=</span> <span class="ident">page</span><span class="punct">.</span><span class="ident">links</span><span class="punct">(&quot;</span><span class="string">@id='signout'</span><span class="punct">&quot;).</span><span class="ident">click</span><span class="punct">(</span><span class="constant">self</span><span class="punct">)</span><br />                              <span class="comment"># locate the sign-out link by its html id</span><br />                              <span class="comment"># and click it</span><br />   <span class="ident">assert_response</span> <span class="symbol">:success</span><br /> <span class="keyword">end</span> </pre> <p>Can't say its a replica of HtmlUnit... but it does meet my needs for now. Notice we didn't need to explicitly handle things like session or where the form submits to. It simply goes to where its supposed to go - as rendered by the view. And yes, as you do submit() and click() you might actually cross different controllers. <a href="http://choonkeat.svnrepository.com/svn/rails-plugins/hpricot_forms/">HpricotForms</a> handles that for you. <br /> <br /> The main thing I like about this API is that the field names in the form are real. If you're careless like me, and modify your action templates (.rhtml files) but forgot to change both your controller and test, traditionally your test will still pass because you were passing in parameters explicitly, e.g.<br /> </p> <pre><span class="ident">post</span> <span class="symbol">:login</span><span class="punct">,</span> <span class="punct">{</span><span class="symbol">:user</span> <span class="punct">=&gt;</span> <span class="punct">{</span><span class="symbol">:login</span> <span class="punct">=&gt;</span> <span class="punct">&quot;</span><span class="string">Joe</span><span class="punct">&quot;,</span> <span class="symbol">:password</span> <span class="punct">=&gt;</span> <span class="punct">&quot;</span><span class="string">topsecret</span><span class="punct">&quot;}}</span><br /> </pre> <p>even though your HTML form fields were changed to &quot;account[login]&quot; and &quot;account[passwd]&quot;. But <a href="http://choonkeat.svnrepository.com/svn/rails-plugins/hpricot_forms/">HpricotForms</a> will raise an exception when you try to set values into fields that does not exist in the rendered form. <br /> </p> <p><a href="http://choonkeat.svnrepository.com/svn/rails-plugins/hpricot_forms/">HpricotForms</a> doesn't add new assert_xxx methods to your test environment since I personally think we've had enough already. It merely deals with navigation. I'm sure programmers out there are capable enough to do their own assertions when they need it.</p> <pre>script/plugin install <a href="http://choonkeat.svnrepository.com/svn/rails-plugins/hpricot_forms">http://choonkeat.svnrepository.com/svn/rails-plugins/hpricot_forms</a> </pre>   <p>Note: <strike>It appears that HpricotForms only work on <a href="http://wiki.rubyonrails.com/rails/pages/EdgeRails">Edge Rails</a>, with <a href="http://svn.jamisbuck.org/rails-plugins/simply_restful/">simply_restful</a> plugin. This is due to the routing changes.</strike> Works with Rails 1.1.4 and Edge Rails. <a href="http://choonkeat.svnrepository.com/rails-plugins/trac.cgi">Feedback</a> is welcome.<br />  </p>   <p><strong>Update</strong></p> <p>Added form.extend!(partial) to allow extending the formfields &nbsp;with a separate HTTP request. i.e. if your form appends fields via xmlHttpRequest, you can now say</p><pre><span class="ident">form</span> <span class="punct">=</span> <span class="ident">page</span><span class="punct">.</span><span class="ident">forms</span><span class="punct">.</span><span class="ident">first</span><br /><span class="ident">form</span><span class="punct">.</span><span class="ident">field_names</span> 	 <span class="comment"># =&gt; [&quot;email[0]&quot;] </span><br />                 	 <span class="comment"># the original form only has 1 field</span><br /><span class="ident">form</span><span class="punct">[&quot;</span><span class="string">email[0]</span><span class="punct">&quot;]</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">email1</span><span class="punct">&quot;</span><br /><br /><span class="ident">form</span><span class="punct">.</span><span class="ident">extend!</span><span class="punct">(</span><span class="ident">get</span> <span class="symbol">:on_security_options_clicked</span><span class="punct">)</span> <span class="keyword">do</span><br />    <span class="ident">form</span><span class="punct">.</span><span class="ident">field_names</span>     <span class="comment"># =&gt; [&quot;email[0]&quot;, &quot;ssl&quot;] </span><br />	                 <span class="comment"># the new fields from the partial is </span><br />    	                 <span class="comment"># appended into our form object. </span><br />    <span class="ident">form</span><span class="punct">[&quot;</span><span class="string">ssl</span><span class="punct">&quot;]</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">true</span><span class="punct">&quot;</span><br /><span class="keyword">end</span><br /><span class="ident">page</span> <span class="punct">=</span> <span class="ident">form</span><span class="punct">.</span><span class="ident">submit</span><span class="punct">(</span><span class="constant">self</span><span class="punct">)</span> <span class="comment"># the combined form will be submitted</span></pre><p>Also, to help kick off the writing of code, form.to_code will print out a series of variable assignment satements based on the default values from the form, e.g. </p><pre><span class="ident">form</span> <span class="punct">=</span> <span class="ident">page</span><span class="punct">.</span><span class="ident">forms</span><span class="punct">.</span><span class="ident">first</span><br /><span class="ident">puts</span> <span class="ident">form</span><span class="punct">.</span><span class="ident">to_code</span><br />		<br /><span class="comment"># this prints lines of Ruby code like:</span><br /><span class="comment"># </span><br /><span class="comment"># form[&quot;from&quot;] = &quot;sender&quot;</span><br /><span class="comment"># form[&quot;email[0]&quot;] = &quot;email1&quot; </span><br /><span class="comment"># form[&quot;options[]&quot;] = [&quot;html&quot;, &quot;read-receipt&quot;]</span></pre>


  </div><a class="u-url" href="/weblog/2006/07/hpricotforms.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">The Devel!</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">choonkeat</li><li><a class="u-email" href="mailto:contactme@choonkeat.com">contactme@choonkeat.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/choonkeat"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">choonkeat</span></a></li><li><a href="https://www.twitter.com/choonkeat"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">choonkeat</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>choonkeat on programming &amp; software</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
