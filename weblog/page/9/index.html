
<!DOCTYPE HTML>
<html lang="en-GB">
<head>
	<meta charset="utf-8">
	<title>choonkeat on programming & software  | The Devel!</title>

	<meta name="author" content="choonkeat">

<meta name="description" content="
		Version control is the best thing since sliced bread (for those whom have just learnt of it). But once branching comes into the picture, it is b..."> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="http://feeds.feedburner.com/choonkeat" rel="alternate" title="The Devel!" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href="/stylesheets/application.css" media="screen, projection" rel="stylesheet" type="text/css">
<script src="/javascripts/application.js"></script>

</head>



<body>
	<header id="header" class="inner"><h1><a href="/">The Devel!</a></h1>
<span class="tagline">choonkeat on programming & software</span>
<nav id="main-nav"><ul>
	<li><a href="/weblog/chew-choon-keat.html">About</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/weblog/chew-choon-keat.html">About</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</div>
	</div>
</nav>


</header>

	<div id="content" class="inner">


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2006/08/on-svk.html">
			
				On SVK</a>
		</h2>
		<div class="meta date">








  


<time datetime="2006-08-30T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>Version control is the best thing since sliced bread (for those whom have <a href="http://www.apple.com/macosx/leopard/timemachine.html">just learnt of it</a>). But once <a href="http://www.ericsink.com/scm/scm_branches.html">branching</a> comes into the picture, it is becomes a <a href="../../articles/2006/05/24/version-control-that-missing-module-in-cs101">hairy</a> thing. </p><p>It might be because humans aren&#8217;t accustomed to think in terms of parallel universe (perhaps sci-fi authors). There appears to have no &quot;<em>one right way</em>&quot; to cater for all scenarios. I used to live and breath on the <em>trunk-is-stable-and-latest</em> camp (half sneering at enterprisey people who &#8217;<em>branch first</em><em>, then merge</em>&#8217;). But it just happens that my past situations only requires so much.<br /> </p><p>Furthermore, some people just prefer the branch-merge-often mentality, others thrive in simplicity of trunk-work-branch-maintain workflow. Like tea people and coffee people. Just different. No point converting anyone over to the other side. Hence I was dabbling to create a script (on-top-of <a href="http://www.dellroad.org/svnmerge/index">svnmerge</a>) to provide dead-simple branch/merge workflow - so trunk ppl can have it so, and branch ppl won&#8217;t be inconvenienced.<br /></p><p>That&#8217;s when I found <a href="http://svk.elixus.org/">SVK</a>. By saying its a &quot;<em>decentralized version control system built with the Subversion filesystem</em>&quot; is really really doing it a huge disservice. My layman version would be &quot;<em>SVK lets you be the branch-merge person you are inside, or the trunk-branch, or watever *%^#$ person you like to do your work in - whilst sharing a common repository with people of different taste! I mean, its like a cup that lets you sip coffee, sit around with everyone, whilst sharing the same pot of tea!</em>&quot;<br /></p><p>SVK has more commands to do magic, but the daily stuff closely resembles SVN: svk commit; svk update; svk diff. It also has another benefit - it doesn&#8217;t pollute your working directory with hidden <em>.svn</em> or <em>CVS</em> folders/files. <a href="http://thegrok.wordpress.com/">Some ppl</a> are irked by that. Those files are consolidated in your home directory. Actually that might be good / bad depending on you being a tea or coffee person.<br /></p><p>The only drawback is that IDE integration is lacking at the moment. And most importantly, the tickets / changesets information on <a href="http://trac.edgewall.org/">Trac</a> wouldn&#8217;t tally directly with my local mirror.<br /></p><p>Oh well, these might not be show stopper after all. Let&#8217;s see how it goes when I use it for real.<br /></p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2006/08/todo-compiled-k.html">
			
				Todo: Compiled KRJS</a>
		</h2>
		<div class="meta date">








  


<time datetime="2006-08-24T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>This <a href="http://railsexpress.de/blog/articles/2006/08/15/rails-template-optimizer-beta-test">template_optimizer</a> plugin looks great. If it can compile for <a href="../../articles/tag/krjs">KRJS</a> too, that&#8217;ll remove its only drawback of slower rendering speed due to method inspection. Any one with a free hand to give it a try?<br /></p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2006/08/quoted-printabl.html">
			
				Quoted-Printable: Bitten for the N-th time!</a>
		</h2>
		<div class="meta date">








  


<time datetime="2006-08-14T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p> <p>I knew I&#8217;d handled this before, but still I&#8217;d forgotten what was going on. Searching the web was <a href="http://www.google.com/search?q=tmail%20unquote%20body%20quoted-printable%20">fruitless</a> - everyone seem happy to simply use str.unpack(&quot;M*&quot;) (aka TMail::Mail.unquoted_body when &quot;quoted-printable&quot;) for getting unquoted body from an email part that is &quot;quoted-printable&quot;.</p> <p>Perhaps I&#8217;m just searching for the wrong terms&#8230; if so, then to ensure I&#8217;ll hit my own result next time, I might as well be the one to put up a post using these terms that I might use:&nbsp; tmail unquote body quoted-printable decode truncated</p> <p>The problem is, I have a email.body (e.g. variable str) that looks like this: <br /> </p> <pre><span class="ident">irb</span><span class="punct">(</span><span class="ident">main</span><span class="punct">):</span><span class="number">002</span><span class="punct">:</span><span class="number">0</span><span class="punct">&gt;</span> <span class="ident">puts</span> <span class="ident">str</span><br /> <span class="constant">This</span> <span class="ident">is</span> <span class="ident">a</span><br /> <span class="punct">=</span><span class="number">20</span><br /> <span class="ident">multiline</span> <span class="ident">te</span><span class="punct">=</span><br /> <span class="ident">xt</span><br /> <span class="punct">=</span><span class="number">20</span><br /> <span class="ident">string</span> <span class="ident">text</span><br /> <span class="punct">=&gt;</span> <span class="constant">nil</span></pre> <p>So far so good. Now I perform an unpack (aka email.unquoted_body) <br /> </p> <pre><span class="ident">irb</span><span class="punct">(</span><span class="ident">main</span><span class="punct">):</span><span class="number">003</span><span class="punct">:</span><span class="number">0</span><span class="punct">&gt;</span> <span class="ident">puts</span> <span class="ident">str</span><span class="punct">.</span><span class="ident">unpack</span><span class="punct">(&quot;</span><span class="string">M*</span><span class="punct">&quot;)</span> <span class="comment"># aka TMail::Mail.unquoted_body when &quot;quoted-printable&quot;</span><br /> <span class="constant">This</span> <span class="ident">is</span> <span class="ident">a</span><br /> <br /> <span class="ident">multiline</span> <span class="ident">te</span><br /> <span class="punct">=&gt;</span> <span class="constant">nil</span></pre> <p>WTF? What happened to the 3rd line of text? *shrugs* but if I do some dos2unix on the string&#8230; <br /> </p> <pre><span class="ident">irb</span><span class="punct">(</span><span class="ident">main</span><span class="punct">):</span><span class="number">004</span><span class="punct">:</span><span class="number">0</span><span class="punct">&gt;</span> <span class="ident">puts</span> <span class="ident">str</span><span class="punct">.</span><span class="ident">gsub</span><span class="punct">(/</span><span class="regex"><span class="escape">\r\n</span></span><span class="punct">/,</span> <span class="punct">&quot;\n&quot;</span><span class="punct">).</span><span class="ident">unpack</span><span class="punct">(&quot;</span><span class="string">M*</span><span class="punct">&quot;)</span><br /> <span class="constant">This</span> <span class="ident">is</span> <span class="ident">a</span><br /> <br /> <span class="ident">multiline</span> <span class="ident">text</span><br /> <br /> <span class="ident">string</span> <span class="ident">text</span><br /> <span class="punct">=&gt;</span> <span class="constant">nil</span></pre> <p>Bah! The email did come from hotmail.com so I&#8217;m biased to think <em>they</em> got it wrong instead of the stdlib. </p> <p>Update: <a href="http://www.freesoft.org/CIE/RFC/1521/6.htm">Hmmmmmm..</a> </p> <pre>Note that many implementations may elect to encode the local<br />representation of various content types directly, as described in<br />Appendix G.  In particular, this may apply to plain text material<br />on systems that use newline conventions other than CRLF<br />delimiters. Such an implementation is permissible, but the<br />generation of line breaks must be generalized to account for the<br />case where alternate representations of newline sequences are<br />used.</pre><pre>quoted-printable := ([*(ptext / SPACE / TAB) ptext] [&quot;=&quot;] CRLF)<br />         ; Maximum line length of 76 characters excluding CRLF</pre><p>Update 2: Ruby stdlib is broken <a href="http://72.14.235.104/search?q=cache:dAM_bdbXon8J:blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-dev/28601%3Fhelp+ruby+unpack+CRLF&amp;hl=en&amp;lr=&amp;strip=1">for unpack</a>. </p> <pre>&nbsp;</pre></p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2006/08/rails-115-brouh.html">
			
				Rails 1.1.5 Brouhaha</a>
		</h2>
		<div class="meta date">








  


<time datetime="2006-08-11T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>So much <a href="http://weblog.rubyonrails.org/2006/8/9/rails-1-1-5-mandatory-security-patch-and-other-tidbits">noise</a>. So much <a href="http://weblog.rubyonrails.org/2006/8/10/security-update-rails-1-0-not-affected">debates</a>. Only <a href="http://weblog.rubyonrails.org/2006/8/10/security-update-rails-1-0-not-affected#comment-11106">1 productive comment</a> in the sea of words.<br /></p><p>The whole brouhaha reminded me of an incident (not programming related) where a friend of mine told another friend specifically NOT to do something. Of cos, quite a lot of hell broke loose.<br /> </p><p>Oh well&#8230;<br /></p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2006/08/rails-calling-r.html">
			
				Rails: Calling render() outside your Controllers</a>
		</h2>
		<div class="meta date">








  


<time datetime="2006-08-05T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>I found myself needing to render a .rxml template from my Model today (Ok, stop the MVC preach already&#8230;) anyways.. found a few <a href="http://lists.rubyonrails.org/pipermail/rails/2006-May/043659.html">deadends</a>, but finally got down to use method_missing to see what&#8217;s needed by ActionViewer::Base. Not sure if there&#8217;s an easier way&#8230; </p><p>&nbsp;</p><pre><span class="comment"># </span><br /><span class="comment"># lib/render_anywhere.rb</span><br /><span class="comment"># </span><br /><span class="comment"># Render templates outside of a controller or view.</span><br /><span class="comment"># </span><br /><span class="comment"># Simply mixin this module to your existing class, for example:</span><br /><span class="comment"># </span><br /><span class="comment">#   class MyTemplater &lt; ActiveRecord::Base</span><br /><span class="comment">#     include RenderAnywhere</span><br /><span class="comment"># </span><br /><span class="comment"># And you can use render() method that works the same as ActionView::Base#render</span><br /><span class="comment"># </span><br /><span class="comment">#   obj = MyTemplater.new</span><br /><span class="comment">#   obj.html = obj.render :file =&gt; '/shared/header'</span><br /><span class="comment"># </span><br /><span class="comment"># </span><br /><span class="keyword">module </span><span class="module">RenderAnywhere</span><br />    <br />    <span class="keyword">class </span><span class="class">DummyController</span><br />        <span class="keyword">def </span><span class="method">logger</span><br />            <span class="constant">RAILS_DEFAULT_LOGGER</span><br />        <span class="keyword">end</span><br />        <span class="keyword">def </span><span class="method">headers</span><br />            <span class="punct">{}</span><br />        <span class="keyword">end</span><br />    <span class="keyword">end</span><br />    <br />    <span class="keyword">def </span><span class="method">render</span><span class="punct">(</span><span class="ident">options</span><span class="punct">,</span> <span class="ident">assigns</span> <span class="punct">=</span> <span class="punct">{})</span><br />        <span class="ident">viewer</span> <span class="punct">=</span> <span class="constant">ActionView</span><span class="punct">::</span><span class="constant">Base</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="constant">Rails</span><span class="punct">::</span><span class="constant">Configuration</span><span class="punct">.</span><span class="ident">new</span><span class="punct">.</span><span class="ident">view_path</span><span class="punct">,</span> <span class="ident">assigns</span><span class="punct">,</span> <span class="constant">DummyController</span><span class="punct">.</span><span class="ident">new</span><span class="punct">)</span><br />        <span class="ident">viewer</span><span class="punct">.</span><span class="ident">render</span> <span class="ident">options</span><br />    <span class="keyword">end</span><br />    <br />    <span class="keyword">def </span><span class="method">template_exists?</span><span class="punct">(</span><span class="ident">path</span><span class="punct">,</span> <span class="ident">assigns</span> <span class="punct">=</span> <span class="punct">{})</span><br />        <span class="ident">viewer</span> <span class="punct">=</span> <span class="constant">ActionView</span><span class="punct">::</span><span class="constant">Base</span><span class="punct">.</span><span class="ident">new</span><span class="punct">(</span><span class="constant">Rails</span><span class="punct">::</span><span class="constant">Configuration</span><span class="punct">.</span><span class="ident">new</span><span class="punct">.</span><span class="ident">view_path</span><span class="punct">,</span> <span class="ident">assigns</span><span class="punct">,</span> <span class="constant">DummyController</span><span class="punct">.</span><span class="ident">new</span><span class="punct">)</span><br />        <span class="ident">viewer</span><span class="punct">.</span><span class="ident">pick_template_extension</span><span class="punct">(</span><span class="ident">path</span><span class="punct">)</span> <span class="keyword">rescue</span> <span class="constant">false</span><br />    <span class="keyword">end</span><br /><span class="keyword">end</span><br /><br /></pre><p>Hope this is helpful to someone&nbsp;</p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2006/07/usb-paranoia.html">
			
				USB Paranoia</a>
		</h2>
		<div class="meta date">








  


<time datetime="2006-07-25T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>Almost a month ago I plugged a brand new USB thumbdrive into my desktop and <a href="../../articles/2006/06/22/back-from-e27-off-to-chicago">it didn&#8217;t work</a>. &quot;<em>Strange, </em>&quot; I thought, &quot;<em>it was working this morning at home&#8230;</em>&quot;. However, a few weeks ago, I plugged in another known-to-be-working thumbdrive into my desktop and it didn&#8217;t work either. And both drives don&#8217;t work anymore. My Indian colleague came over, plugged his India brand thumbdrive into the port and it didn&#8217;t work too - but it continue to work on his computer. So I thought I was just unlucky to have 2 lousy thumbdrives in a row. The only lucky thing is, I didn&#8217;t lose critical data in both incidents.<br /></p><p>Revelation came a week ago when I plugged in my <a href="http://www.thinkgeek.com/computing/accessories/5dee/">usb fan</a> for a faster cool down after lunch. The fan was spinning, but there was no wind. The fan was spinning pretty fast&#8230; <strong>in the opposite direction</strong>! No wonder my thumbdrives died!!!<br /></p><p>As a result, I&#8217;m now a bit paranoid when I have to plug something into an unfamiliar USB port - I <em>have</em> to know its a known-to-be-working port. Its funny because my paranoia apparently spreaded to my french colleague who had to plug his minty fresh external harddisk into his USB port.. without a fan to test.<br /></p><p>Damn, how did that India brand USB continue to survive?</p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2006/07/synergy-one-key.html">
			
				Synergy: One keyboard (and mouse) to rule them all</a>
		</h2>
		<div class="meta date">








  


<time datetime="2006-07-25T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>For a well written, commercial quality &quot;what is this about&quot;, read here: http://www.stardock.com/products/multiplicity/</p><p>If you&#8217;re sold on the idea, download here: http://synergy2.sourceforge.net/index.html</p><p>If you&#8217;re using ubuntu, install it like this: http://philisoft.com/blog/install-latest-synergy-on-ubuntu/</p><p>To configure, reference here: http://www.linux.com/article.pl?sid=06/05/25/1439237&nbsp;</p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2006/07/hpricotforms.html">
			
				HpricotForms</a>
		</h2>
		<div class="meta date">








  


<time datetime="2006-07-19T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>Since the introduction of <a href="http://redhanded.hobix.com/inspect/hpricot01.html">Hpricot</a>, the snazzy and fast Ruby parser for HTML, I&#8217;ve been meaning to give it a whirl - the API looks yummy. Now, as I&#8217;m doing more testing and validation stuff at work, such a need has come. Back in Javaland, when I need to navigate or test web apps by code, submit forms and do other web bot stuff, I turn to <a href="http://htmlunit.sourceforge.net/gettingStarted.html">HtmlUnit</a>. The api is simply awesome and won me over immediately. So if you&#8217;re still stuck in Java, do give it a look.</p> <p>Anyways, though the whole testing harness of Rails is a godsend, I started to miss some of those HtmlUnit goodies - pulling out a Form object from a visited page, setting the fields values and submitting it.. and getting back a Page. So, this is what I&#8217;ve come up with for use in functional tests:<br /> </p> <pre><span class="keyword">def </span><span class="method">test_login_logout</span><br />   <span class="ident">page</span> <span class="punct">=</span> <span class="ident">get</span> <span class="symbol">:new</span>            <span class="comment"># first, let's get to the login page</span><br />   <span class="ident">form</span> <span class="punct">=</span> <span class="ident">page</span><span class="punct">.</span><span class="ident">forms</span><span class="punct">.</span><span class="ident">first</span>    <span class="comment"># next, get a reference to the form</span><br />   <span class="comment"># form.field_names =&gt; [&quot;user[login]&quot;, &quot;user[password]&quot;]</span><br />                              <span class="comment"># form.field_names returns you the input fields</span><br />                              <span class="comment"># available in the form</span><br /> <br />   <span class="ident">form</span><span class="punct">[&quot;</span><span class="string">user[login]</span><span class="punct">&quot;]</span>    <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">Joe</span><span class="punct">&quot;</span><br />   <span class="ident">form</span><span class="punct">[&quot;</span><span class="string">user[password]</span><span class="punct">&quot;]</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">topsecret</span><span class="punct">&quot;</span><br />   <span class="ident">page</span> <span class="punct">=</span> <span class="ident">form</span><span class="punct">.</span><span class="ident">submit</span><span class="punct">(</span><span class="constant">self</span><span class="punct">)</span>   <span class="comment"># after setting the form values, submit it</span><br />                              <span class="comment"># 'page' now references the page after login</span><br />   <span class="ident">assert_response</span> <span class="symbol">:success</span><br />   <span class="comment"># page.links               # returns you an array of links found on the page</span><br /> <br />   <span class="ident">page</span> <span class="punct">=</span> <span class="ident">page</span><span class="punct">.</span><span class="ident">links</span><span class="punct">(&quot;</span><span class="string">@id='signout'</span><span class="punct">&quot;).</span><span class="ident">click</span><span class="punct">(</span><span class="constant">self</span><span class="punct">)</span><br />                              <span class="comment"># locate the sign-out link by its html id</span><br />                              <span class="comment"># and click it</span><br />   <span class="ident">assert_response</span> <span class="symbol">:success</span><br /> <span class="keyword">end</span> </pre> <p>Can&#8217;t say its a replica of HtmlUnit&#8230; but it does meet my needs for now. Notice we didn&#8217;t need to explicitly handle things like session or where the form submits to. It simply goes to where its supposed to go - as rendered by the view. And yes, as you do submit() and click() you might actually cross different controllers. <a href="http://choonkeat.svnrepository.com/svn/rails-plugins/hpricot_forms/">HpricotForms</a> handles that for you. <br /> <br /> The main thing I like about this API is that the field names in the form are real. If you&#8217;re careless like me, and modify your action templates (.rhtml files) but forgot to change both your controller and test, traditionally your test will still pass because you were passing in parameters explicitly, e.g.<br /> </p> <pre><span class="ident">post</span> <span class="symbol">:login</span><span class="punct">,</span> <span class="punct">{</span><span class="symbol">:user</span> <span class="punct">=&gt;</span> <span class="punct">{</span><span class="symbol">:login</span> <span class="punct">=&gt;</span> <span class="punct">&quot;</span><span class="string">Joe</span><span class="punct">&quot;,</span> <span class="symbol">:password</span> <span class="punct">=&gt;</span> <span class="punct">&quot;</span><span class="string">topsecret</span><span class="punct">&quot;}}</span><br /> </pre> <p>even though your HTML form fields were changed to &quot;account[login]&quot; and &quot;account[passwd]&quot;. But <a href="http://choonkeat.svnrepository.com/svn/rails-plugins/hpricot_forms/">HpricotForms</a> will raise an exception when you try to set values into fields that does not exist in the rendered form. <br /> </p> <p><a href="http://choonkeat.svnrepository.com/svn/rails-plugins/hpricot_forms/">HpricotForms</a> doesn&#8217;t add new assert_xxx methods to your test environment since I personally think we&#8217;ve had enough already. It merely deals with navigation. I&#8217;m sure programmers out there are capable enough to do their own assertions when they need it.</p> <pre>script/plugin install <a href="http://choonkeat.svnrepository.com/svn/rails-plugins/hpricot_forms">http://choonkeat.svnrepository.com/svn/rails-plugins/hpricot_forms</a> </pre>   <p>Note: <strike>It appears that HpricotForms only work on <a href="http://wiki.rubyonrails.com/rails/pages/EdgeRails">Edge Rails</a>, with <a href="http://svn.jamisbuck.org/rails-plugins/simply_restful/">simply_restful</a> plugin. This is due to the routing changes.</strike> Works with Rails 1.1.4 and Edge Rails. <a href="http://choonkeat.svnrepository.com/rails-plugins/trac.cgi">Feedback</a> is welcome.<br />  </p>   <p><strong>Update</strong></p> <p>Added form.extend!(partial) to allow extending the formfields &nbsp;with a separate HTTP request. i.e. if your form appends fields via xmlHttpRequest, you can now say</p><pre><span class="ident">form</span> <span class="punct">=</span> <span class="ident">page</span><span class="punct">.</span><span class="ident">forms</span><span class="punct">.</span><span class="ident">first</span><br /><span class="ident">form</span><span class="punct">.</span><span class="ident">field_names</span> 	 <span class="comment"># =&gt; [&quot;email[0]&quot;] </span><br />                 	 <span class="comment"># the original form only has 1 field</span><br /><span class="ident">form</span><span class="punct">[&quot;</span><span class="string">email[0]</span><span class="punct">&quot;]</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">email1</span><span class="punct">&quot;</span><br /><br /><span class="ident">form</span><span class="punct">.</span><span class="ident">extend!</span><span class="punct">(</span><span class="ident">get</span> <span class="symbol">:on_security_options_clicked</span><span class="punct">)</span> <span class="keyword">do</span><br />    <span class="ident">form</span><span class="punct">.</span><span class="ident">field_names</span>     <span class="comment"># =&gt; [&quot;email[0]&quot;, &quot;ssl&quot;] </span><br />	                 <span class="comment"># the new fields from the partial is </span><br />    	                 <span class="comment"># appended into our form object. </span><br />    <span class="ident">form</span><span class="punct">[&quot;</span><span class="string">ssl</span><span class="punct">&quot;]</span> <span class="punct">=</span> <span class="punct">&quot;</span><span class="string">true</span><span class="punct">&quot;</span><br /><span class="keyword">end</span><br /><span class="ident">page</span> <span class="punct">=</span> <span class="ident">form</span><span class="punct">.</span><span class="ident">submit</span><span class="punct">(</span><span class="constant">self</span><span class="punct">)</span> <span class="comment"># the combined form will be submitted</span></pre><p>Also, to help kick off the writing of code, form.to_code will print out a series of variable assignment satements based on the default values from the form, e.g. </p><pre><span class="ident">form</span> <span class="punct">=</span> <span class="ident">page</span><span class="punct">.</span><span class="ident">forms</span><span class="punct">.</span><span class="ident">first</span><br /><span class="ident">puts</span> <span class="ident">form</span><span class="punct">.</span><span class="ident">to_code</span><br />		<br /><span class="comment"># this prints lines of Ruby code like:</span><br /><span class="comment"># </span><br /><span class="comment"># form[&quot;from&quot;] = &quot;sender&quot;</span><br /><span class="comment"># form[&quot;email[0]&quot;] = &quot;email1&quot; </span><br /><span class="comment"># form[&quot;options[]&quot;] = [&quot;html&quot;, &quot;read-receipt&quot;]</span></pre>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2006/07/automating-task.html">
			
				Automating Tasks: Data Migrations</a>
		</h2>
		<div class="meta date">








  


<time datetime="2006-07-19T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p style="padding: 1em; font-style: italic;  background-color: #ddeeee; -moz-border-radius: 1em; -webkit-border-radius: 1em; ">
Although <a href="http://www.sharphosts.com/rev/hostgator.htm">hostgator</a> has been here for quite a few years, the 
<a href="http://www.sharphosts.com">web hosting</a> market is being rapidly taken over by <a href="http://www.sharphos
ts.com/rev/startlogic.htm">startlogic</a>. This will make gator third, with <a href="http://www.sharphosts.com/rev/blu
ehost.htm">bluehost</a> at the first position.</p>

<p>If you&#8217;ve written a .bat file before, shell script, Microsoft Word Macro, or Excel Macro before.. you&#8217;ve exercised one of the fundamental purpose of software - to perform the same, repeatable task on your behalf - aka be your slave.<br> <br> Its funny then that we sometimes find ourselves being the slaves of the software we use. Uploading stuff one by one, two by two, anyone? <br> <br><blockquote> &#8221;<span style="font-style: italic">That&#8217;s not a bug - its an intentional inconvenience! Aka a mechanism to uncover hidden but very real needs which would otherwise be buried by other needs, aka I-think-I need.</span>&#8221;<br></blockquote> <br> Taking that [software as slaves] into account, its strange to find 2 new tool to only surface rather recently from the land of application frameworks. Stuff that let&#8217;s you tackle the problem once, but will be stupidly repeatable by the computer. I&#8217;m as guilty as everyone else for their late arrival. Looking back, I&#8217;ve asked myself how I have managed to get by without them? Especially when I&#8217;ve mostly worked in dotcoms that rolls out web apps almost by the week!<br> <br> <font size="4">1. Data Migrations Management</font><br> <br> Even if the code is flawless now, requirements will change <span style="font-style: italic">*sigh*</span>. Unfortunately, at the other end of the HTTP pipe is a real and unpredictable human being who is thinking about&#8230; not your application, but that Zara sale in town. That&#8217;s why we have <a href="../../articles/2006/05/24/version-control-that-missing-module-in-cs101">version control</a> - undo code changes, look at who + when + why a certain function was modified. To manage the evolution of rules and logic.<br> <br> These rules and logic ultimately manages data. And data is put into buckets. These buckets were sculpted right at the start of the project: &#8221;<span style="font-style: italic">A student will have a name, age and gender</span>&#8221; roughly translates to <span style="font-family: courier new,monospace">CREATE TABLE students (id INT PRIMARY KEY AUTO_INCREMENT NOT NULL, name VARCHAR(255), age INT, gender SET(&#8216;M&#8217;, &#8216;F&#8217;, &#8216;U&#8217;));</span> But these buckets need to evolve too. Hand-in-hand, together with the code. <span style="font-family: courier new,monospace">ALTER</span>, <span style="font-family: courier new,monospace">CREATE</span> and <span style="font-family: courier new,monospace">DROP</span>. Changes to these buckets if allowed to proceed without trace would be a great step back against the efforts of having the code being religiously version controlled ain&#8217;t it?<br> <br> Why then, are the prevaling methods for managing data migrations 1) version control 1 x SQL CREATE script, and 2) collect a growing bunch of SQL scripts in a version controlled directory?<br> <br> Method #1 will collapse once the application is deployed <span style="font-style: italic">somewhere</span> with data - since CREATE scripts only deal with CREATING to buckets, not dealing with the scenario where the buckets are already there.. with data. Most often, once into maintenance mode, teams will intuitively adopt method #2, rendering the original, carefully bonsai&#8217;d CREATE script next to useless. <br> <br> Method #2 generally only handles schema changes in 1 direction - &#8221;<span style="font-style: italic">Attn all developers, send your SQL updates to me, I need to go down to the data centre this evening to deploy the latest&#8230; </span>&#8221;. If all goes well, then great. But ever since Murphy created mishaps, life has never been that smooth. &#8221;<span style="font-style: italic">Hey mike, users are calling support - last evening&#8217;s update broke something? We need to&#8230; </span>&#8221; Hmm, rolling back the code is easy&#8230; but rolling back the schema changes is another thing&#8230; which leads us to the next flaw. SQL can describe schema changes well, but has limited capability in communicating data migrations - which is ironically the more important thing in a production environment. &#8221;<span style="font-style: italic">Hi mike, I&#8217;ve split our name column into family_name and given_name&#8230; the gender field is changed from M,F,U to 0,1,2 referencing the new gender table.. also, we realise dates should be stored in GMT, I&#8217;ve added a column to store the timezone</span>&#8221; That&#8217;s some hairy SQL to write for migrating&#8230; and rolling back.<br> <br> Rails comes with a neat tool called <a href="http://wiki.rubyonrails.com/rails/pages/UnderstandingMigrations">Rails Migrations</a>. What is does is very simple: Manage database migrations and in code, not SQL. And thanks to Rails&#8217; ActiveRecord, the code is actually very succint to read and write. Its role is so simple, there&#8217;s even flaws. But whatever flaw you pick&#8230; they are definitely not a bigger problem than not managing migrations at all.<br> <br> Doing 2-way migrations of schema and data in Ruby code (ActiveRecord) is definitely much easier to express than anything out there. Hands down. Did I say its a 2-way migration? Rolling back a broken release now becomes within reach: <a href="http://rails.techno-weenie.net/tip/2006/1/7/rake_migrate_with_a_relative_version_number"><span style="font-family: courier new,monospace">rake migrate down</span></a>. Man, its really satisfying and addictive test out those migrations all day long, and migrate down, migrate down, migrate until the data literally rollsback into its womb!<br> <br> The beauty (and stress free moment) reveals itself when you have a few deployments to update the code with. It might be the demo laptop the sales team has been bringing out, 20 revisions ago.. you think&#8230; and that production system in some server somewhere updated last tuesday&#8230; no more &#8221;<span style="font-style: italic">let&#8217;s reinstall everything!</span>&#8221; (the sales team are human you know? entering all those demo data&#8230; ) or &#8221;<span style="font-style: italic">I&#8217;ll manually compare upgrade your data</span>&#8221;.. just do <span style="font-family: courier new,monospace">rake migrate</span> and the schema and data will be brought up to date from whichever state they were in. Fuss free. And as mentioned, upgrading to the latest code is the easier part.<br> <br> So, don&#8217;t collect the ALTER SQL scripts last minute and stress out your deployment guy at the data centre. Its pretty cold in there already. Tackle the problem early and in small steps. Get the developers to write (and test locally) the up and down migrations as-and-when changes are required. We all will suffer failures, just try to fail fast and early.<br> <br> Of course, Rails Migrations isn&#8217;t a be-all-end-all thing. At my work place, Rails isn&#8217;t everything and there are other languages and subsystems to live in harmony with. So requiring everyone to have a dependency on Rails just for schema management might be asking too much. I don&#8217;t have to use Rails Migrations&#8230; but I am sold on the purpose it serves. So, we created our own standalone script to do approximately the same thing. I just have to live without the ActiveRecord API :-(<br> <br> Strange that most fullstack development frameworks doesn&#8217;t come with schema management solution. Are there any standalone migrations tool that does like Rails Migrations? <br> <br> Oh did I say 2 new stuff? Its late, I&#8217;ll stop at this one today.</p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2006/07/simplify-simpli.html">
			
				Simplify, simplify&#8230;</a>
		</h2>
		<div class="meta date">








  


<time datetime="2006-07-11T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<blockquote><p><em>Our life is frittered away by detail. Simplify, simplify.</em><br /><em>- Henry David Thoreau</em></p></blockquote><p>One of my favourite quote. What&#8217;s wrong with <a href="http://en.wikipedia.org/wiki/KISS_Principle">simple</a>?&nbsp;</p>


		
		
	</div>

</article>


    <nav id="pagenavi">
        
            <a href="/weblog/page/8/" class="prev">Previous</a>
        
        
            <a href="/weblog/page/10/" class="next">Next</a>
        
    </nav>

</div>
	<footer id="footer" class="inner">&copy; 2016

    choonkeat

</footer>
	<script src="/javascripts/slash.js"></script>
<!-- <script src="/javascripts/hyphenator.js"></script> -->


<script type="text/javascript">
      var disqus_shortname = 'choonkeat';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-1438738-3']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




</body>
</html>
