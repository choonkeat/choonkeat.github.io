
<!DOCTYPE HTML>
<html lang="en-GB">
<head>
	<meta charset="utf-8">
	<title>choonkeat on programming & software  | The Devel!</title>

	<meta name="author" content="choonkeat">

<meta name="description" content="
		Finally! Google Translate gets API-ed. I was glad to see a &quot;detect&quot; method provided - meaning you tell what language a piece of text i..."> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="http://feeds.feedburner.com/choonkeat" rel="alternate" title="The Devel!" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href="/stylesheets/application.css" media="screen, projection" rel="stylesheet" type="text/css">
<script src="/javascripts/application.js"></script>

</head>



<body>
	<header id="header" class="inner"><h1><a href="/">The Devel!</a></h1>
<span class="tagline">choonkeat on programming & software</span>
<nav id="main-nav"><ul>
	<li><a href="/weblog/chew-choon-keat.html">About</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/weblog/chew-choon-keat.html">About</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</div>
	</div>
</nav>


</header>

	<div id="content" class="inner">


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2008/03/tryanslator2.html">
			
				Tryanslator2!</a>
		</h2>
		<div class="meta date">








  


<time datetime="2008-03-22T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>Finally! Google Translate <a href="http://www.readwriteweb.com/archives/google_releases_ajax_language_api.php">gets API-ed</a>. I was glad to see a &quot;detect&quot; method provided - meaning you tell what language a piece of text is in. Weird that the actual Google Translate service <em>still doesn&#8217;t</em> use it to improve their form defaults.</p>

<p>So I gave my old &quot;<a href="http://blog.choonkeat.com/weblog/2005/12/translate-from.html">Tryanslator</a>&quot; (try and translate) an update, and <a href="http://dev.choonkeat.com/js/lang/index">a new home</a>:<br /><a title="Tryanslator v2 by choonkeat, on Flickr" href="http://www.flickr.com/photos/choonkeat/2351050091/"><img width="500" height="269" border="0" alt="Tryanslator v2" src="http://farm4.static.flickr.com/3189/2351050091_ea47be79f3.jpg" /></a></p>

<p>Few notes</p>

<ul><li>No asking of &quot;Translate From?&quot; - if you don&#8217;t know how to read it, you probably don&#8217;t know what it is written in.</li>

<li>Language to &quot;Translate to&quot; defaults to user&#8217;s browser language.</li>

<li>Language options are written in their own language (duh).</li>

<li>Google provides a rigid list of &quot;translation pair&quot; (i.e. English to Chinese, but not Chinese to Spanish). Tryanslator2 does an extra bounce to Google&#8217;s server, using English as the mid-way to obtain a any-to-any translation.</li>

<li>No submit button, just type and wait.</li>

<li>All important text on the page auto-translate themselves to the reader&#8217;s language, including &quot;Please wait&#8230;&quot; :-)</li></ul>

<p><a href="http://dev.choonkeat.com/js/lang/index">Give it a try</a>!</p><br />


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2008/03/information-ove.html">
			
				Information overload? Read Later!</a>
		</h2>
		<div class="meta date">








  


<time datetime="2008-03-21T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>There are so many things to read on the web - tech news, links from
friends and blogs - and I’d open them, “hmm looks interesting, will
read them later” but never could find time to do so in day.</p>
<blockquote><p><a href="http://grokked.tumblr.com/">grokked</a>: hi, do
you know any web service that can add arbitary web pages to an RSS
feed? like i have a whole bunch of pages open in my browser and i want
to just add them into google reader for review later<br />
<em>me: maybe can email urself the page or soemthing.. or maybe delicious them. that’s also an RSS<br />
</em>grokked: i was thinking more of the actual page appearing within google reader… this only give me urls<br />
<em>me: hmmm</em></p></blockquote>
<p>And hence an experimental feature was quietly launched: The “read
later” bookmarklet - Click on the bookmarklet and <a href="http://sharedcopy.com/">SharedCopy</a> will stash
the page somewhere for you to read later, in your favourite feed reader:</p>
<blockquote><p>
<a href="http://www.flickr.com/photos/choonkeat/2347934180/" title="sharedcopy - &quot;read later&quot; feature by choonkeat, on Flickr"><img width="240" height="149" border="0" src="http://farm3.static.flickr.com/2087/2347934180_4109b768fa_m.jpg" alt="sharedcopy - &quot;read later&quot; feature" /></a>
</p></blockquote>
<p><a href="http://sharedcopy.com/">Try it out!</a> You can find your own “read later” feed at the bottom of your account “Settings” page :-)</p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2008/03/a-clearer-layou.html">
			
				A Clearer Layout For Viewing Timezones</a>
		</h2>
		<div class="meta date">








  


<time datetime="2008-03-19T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>After putting up <a href="http://jobs.37signals.com/jobs/2749">a job post for SharedCopy</a> at the 37signals job board, I&#8217;ve gotten quite a fair bit of response and in turn, had to propose timings for Skype calls very often.</p>

<p>I hate timezones.</p>

<p>For my purpose (i.e. propose a time where all parties are at least awake!) I figure I&#8217;d just need a simple view of everybody&#8217;s clock over a period of 1 day - which can be done in Ruby:<br /> </p><blockquote><p>24.times do |hh|<br />&nbsp; puts [+8, -7, -5].collect {|tz| Time.now.utc + hh + (tz * 3600) }.inspect<br />end</p></blockquote><p>Functional, but a chore to run and the output is still a mess to pick out information from. Then I did a proper one in Javascript, in case I ever need to use it while on the move&#8230; ;-) </p>
<blockquote><p><a href="http://dev.choonkeat.com/js/cleartz/index#,8,18,-6" title="Timezone Comparison Viewer by choonkeat, on Flickr"><img width="166" height="240" border="0" src="http://farm3.static.flickr.com/2299/2345726166_fd42e55ca8_m.jpg" alt="Timezone Comparison Viewer" /></a></p></blockquote>

<p>[Update] A few notes:</p>

<ul><li>The darker/<strong>shaded areas are ZZZ hours</strong> - so just look for horizontals where the &quot;whites&quot; align.</li>

<li>Your own timezone should automatically show up - so <strong>most usage is only 1 click</strong>.</li>

<li>URL changes as you add timezones - so you <strong>can even bookmark the page</strong> and remember a standard set of timezones.</li>

<li>Day-of-week is subtly indicated just so <strong>you can tell if its the same day or otherwise</strong>.</li>

<li><strong>Name of location</strong> is used instead of numeric offset (and <strong>auto resized to fit</strong>) for a more humane experience</li></ul>

<p>&nbsp;</p>

<p>Try it out at <a href="http://dev.choonkeat.com/js/cleartz/index">http://dev.choonkeat.com/js/cleartz/index</a></p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2008/02/microhoo.html">
			
				Microhoo</a>
		</h2>
		<div class="meta date">








  


<time datetime="2008-02-06T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>There&#8217;s a lot of opinions on Microsoft&#8217;s decision to bid for Yahoo.. but Fake Steve, in his usual over the top commentary style, blabbered one that saw real blood:</p>



<div id='shcp_0ebd074d44df873bad94941db1f7916b'><blockquote style='margin-left: 0; padding-left: 1em; border-left: 1em #eee solid; '> <span class="content comments_count_3 withoutphoto" ><span class="text" ><div class="html_gist none"><input class="csspath" type="hidden" value="body div#outer-wrapper div#wrap2 div#content-wrapper div#main-wrapper div#main.main.section div#Blog1.widget.Blog div.blog-posts.hfeed div.post.uncustomized-post-template div.post-body p a img.shcp_dimension_280x329" /><img class="shcp_dimension_280x329" src="http://bp2.blogger.com/_pNJFZtinpKY/R6VFI0-0p-I/AAAAAAAAC28/zHVpfgvUBtM/s400/ballmerfist1.jpg" height="150" alt="" /></div> <blockquote class="comment_body comment_body1" >It&#8217;s like taking the two guys who finished second and third in a 100-yard dash and tying their legs together and asking for a rematch, believing that now they&#8217;ll run faster.<a href="http://r6.sharedcopy.com/enk3kqh6#shcp1" > <sup>link &raquo;</sup></a ></blockquote> <blockquote class="comment_body comment_body2" >He&#8217;s not really a tech guy. He has a mindset that was formed in Detroit, where he grew up. He&#8217;s a Big Three automaker kind of guy. And this is a Big Three move. It&#8217;s Ford buying Jaguar and Land Rover and Volvo because they can&#8217;t think of anything else to do.<a href="http://r6.sharedcopy.com/enk3kqh6#shcp2" > <sup>link &raquo;</sup></a ></blockquote> <blockquote class="comment_body comment_body3" >Ballmer said he loved when his rivals merged, because whenever the also-rans in any market start teaming up they might as well be waving a white flag. Because it&#8217;s over. You&#8217;ve beaten them. You&#8217;ve driven them to despair. They haven&#8217;t been able to beat you on their own; there&#8217;s no way they&#8217;ll do it together. Then he told me that line about the hundred-yard dash. I&#8217;ll never forget it. But I guess he has.<a href="http://r6.sharedcopy.com/enk3kqh6#shcp3" > <sup>link &raquo;</sup></a ></blockquote> </span ></span> - from <a href="http://r6.sharedcopy.com/enk3kqh6">The Secret Diary of Steve Jobs: Monkey Boy&#8217;s three-legged race</a> via <a href="http://sharedcopy.com">sharedcopy.com</a></blockquote></div><style>#shcp_0ebd074d44df873bad94941db1f7916b blockquote blockquote { margin-left: 1.5em;  font-style: italic; }; #shcp_0ebd074d44df873bad94941db1f7916b .html_gist { display: none; }</style><script>  var json_0ebd074d44df873bad94941db1f7916b = {   host: 'sharedcopy.com',   width: '480px',   height: '300px',   bgcolor: '#ffffff',   background: '#ffffff url(http://fakesteve.blogspot.com.sharedcopy.com/images/loading.gif) no-repeat center center; ',   src: 'http://fakesteve.blogspot.com.sharedcopy.com/embeds/copy/choonkeat/0ebd074d44df873bad94941db1f7916b/480.300/ffffff.ffffff.cc0500/shcp3.html' };</script><script src='http://sharedcopy.com/static/embed/script.js'></script>


<p>Time to buy Google shares.</p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2007/11/singapore-rb-me.html">
			
				Singapore-RB meetup: OAuth4R Presentation PDF</a>
		</h2>
		<div class="meta date">








  


<time datetime="2007-11-30T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>Here are my slides for the OAuth and OAuth4R presentation I made this evening. Thanks folks.</p>

<div style="width:425px;text-align:left" id="__ss_185797"><object style="margin:0px" width="425" height="355"><param name="movie" value="http://static.slideshare.net/swf/ssplayer2.swf?doc=oauth4-and-oauth4r-1196355779128126-5"/><param name="allowFullScreen" value="true"/><param name="allowScriptAccess" value="always"/><embed src="http://static.slideshare.net/swf/ssplayer2.swf?doc=oauth4-and-oauth4r-1196355779128126-5" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="425" height="355"></embed></object><div style="font-family:tahoma,arial;height:26px;padding-top:2px;"><a href="http://www.slideshare.net/?src=embed"><img src="http://static.slideshare.net/swf/logo_embd.png" style="border:0px none;margin-bottom:-5px" alt="SlideShare"/></a> | <a href="http://www.slideshare.net/choonkeat/oauth4-and-oauth4r" title="View 'OAuth4 (and OAuth4R)' on SlideShare">View</a> | <a href="http://www.slideshare.net/upload">Upload your own</a></div></div>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2007/11/the-unspecial-c.html">
			
				The &quot;No Special Case&quot; Pattern</a>
		</h2>
		<div class="meta date">








  


<time datetime="2007-11-23T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>Very often I&#8217;ll write (or use) APIs that look like this (translate accordingly for Ruby / Javascript code)</p><blockquote><pre><pre><strong><span class="storage storage_type storage_type_java">Thing</span></strong> findOneThing(<strong>Key<span class="storage storage_type storage_type_java">&nbsp;</span></strong> key);<span style="color: #999999;"><br /><span class="comment comment_line comment_line_double-slash comment_line_double-slash_java">// if nothing is found, throw an Exception or return null</span></span><br /><br /><strong><span class="support support_type support_type_built-ins support_type_built-ins_java">Collection</span></strong> findManyThings(<strong><span class="support support_type support_type_built-ins support_type_built-ins_java">Collection</span></strong> keyList);<br /><span style="color: #999999;"><span class="comment comment_line comment_line_double-slash comment_line_double-slash_java">// if nothing is found, return null</span></span>
</pre></pre></blockquote><p>All well and good? I&#8217;d known the textbook-bullet-points for this, but for the longest time, I didn&#8217;t realize how much tax I&#8217;m paying subconsciously.. and just how many APIs are ignoring this wisdom:</p>





<div id='shcp_37fafa3939147b8e0f4926089cac28b7'><blockquote style='margin-left: 0; padding-left: 1em; border-left: 1em #eee solid; '> <span class="content comments_count_3 withoutphoto" ><span class="text" > <blockquote class="comment_body comment_body1" >Nulls are awkward things in object-oriented programs because they defeat polymorphism.<a href="http://r9.sharedcopy.com/1nvbt#shcp1" > <sup>link &raquo;</sup></a ></blockquote> <blockquote class="comment_body comment_body2" >Instead of returning null, or some odd value, return a Special Case that has the same interface as what the caller expects.<a href="http://r9.sharedcopy.com/1nvbt#shcp2" > <sup>link &raquo;</sup></a ></blockquote> <p class="comment_body comment_body3" >Not all language can do this easily<a href="http://r9.sharedcopy.com/1nvbt#shcp3" > <sup>link &raquo;</sup></a ></p> </span ></span> - from <a href="http://r9.sharedcopy.com/1nvbt">P of EAA: Special Case</a> via <a href="http://sharedcopy.com">sharedcopy.com</a></blockquote></div><style>#shcp_37fafa3939147b8e0f4926089cac28b7 blockquote blockquote { margin-left: 1.5em;  font-style: italic; }; #shcp_37fafa3939147b8e0f4926089cac28b7 .html_gist { display: none; }</style><script>  var json_37fafa3939147b8e0f4926089cac28b7 = {   host: 'sharedcopy.com',   width: '480px',   height: '250px',   bgcolor: '#fff',   background: '#fff url(http://martinfowler.com.sharedcopy.com/images/loading.gif) no-repeat center center; ',   src: 'http://martinfowler.com.sharedcopy.com/embeds/copy/choonkeat/37fafa3939147b8e0f4926089cac28b7/480.250/e3f0f6.fff.cc0500/shcp1.html' };</script><script src='http://sharedcopy.com/static/embed/script.js'></script>




<p>Finding yourself having to check for null return values? That&#8217;s not &quot;the way it is&quot;, that&#8217;s tax. </p>

<p>Ruby helps <em>a bit</em> by making &quot;nil&quot; an object, paving way for the much loved duck-typing. Whereas some languages settle for dead bodies equivalent nulls. Especially in these languages, having to &quot;<em>return a empty object with the same interface</em>&quot; is a real chore. Person? EmptyPerson. Record? EmptyRecord.. ad infinitum</p>

<p>Still, a language can really only help so much. And it is up to the library authors (i.e. you) to put this wisdom into practice. &quot;Practice?&quot;. Now comes the funny part.</p>

<p>When talking about &quot;design patterns&quot;, usually images of &quot;Enterprise&quot;, &quot;UML&quot;, &quot;Configuration files&quot; start appearing in my mind. So I find it ironic that the best real example of this pattern comes from the lowly-regarded (by many &quot;real&quot; engineers) realm of Javascript. Its called <a href="http://jquery.com/blog/2006/08/20/why-jquerys-philosophy-is-better/">jQuery</a>.</p>

<p>In fact, jQuery takes it even further&nbsp; by simplifying Martin Fowler&#8217;s pattern into a single practical use-case: Returning 1 object is equivalent to returning a List containing 1 object. By <strong>always</strong> returning a List (which can be empty, duh), it has even avoided the need to conjure special &quot;null object with equivalent interface&quot;! And most importantly, &quot;practical&quot; because all languages can do empty list.</p>

<p>Its amazing how simple your train of thought (and code!) becomes when everything is a list (<em>tiny voice: uh.. Lispers knew that since before you were born&#8230; blah blah</em>). There&#8217;s nothing to decide, you always loop through the return value. 0 time? 1 time? N times? Imagine all those other idioms &amp; body of code, now becoming unnecessary&#8230; its applying liposuction for your source code! <br /><br />I don&#8217;t suppose its too far fetched to apply some jQuery-ism to ActiveRecord API is it?</p>

<p>Update: Changed title from &quot;Unspecial Case&quot; to the &quot;No Special Case&quot;, which is more correct.</p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2007/11/coming-full-cir.html">
			
				Learning Web Development</a>
		</h2>
		<div class="meta date">








  


<time datetime="2007-11-21T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>Much in the spirit of &quot;Skinny Controllers and Fat Models&quot;, I&#8217;m coming round to the fact that Single-Table Inheritance for is <del>the evil</del> best avoided.</p>



<p>All that code-reuse might look sexy and get all the OOP noddings. But in the longer run, the risk is that my code (esp. domain/business logic) end up as <a href="http://www.laputan.org/mud/">big balls of mud</a>. But this &quot;risk&quot; is taken in the bid to stave off something more imminent - code repetition. SQL everywhere? No, wrap in a function! No, wrap in a Class! No, inherit from that BaseClass! Fewest blocks to build the tallest cathedrals - architectural elegance.</p>



<p>But buildings don&#8217;t evolve. When requirements evolve, aka &quot;reveal their true selves&quot;, the models start to diverge bit by bit and my OOP-instinct intuitively hold them together. Then one day, often when its too late or a new team member joins, I realise the models are really not of the same family
anymore. To my chagrin, the glue holding the inheritance were more about preventing them from stepping over each other. And the result is worse than the repetition I&#8217;d avoided.</p>

<p>Another related issue is RESTful controllers - &quot;Oh, so 2006&quot; you say. Sorry I&#8217;d only drank half the CRUD kool-aid. Now I&#8217;m feeling the pain on those parts where I&#8217;d chosen to go the other way when there&#8217;s a Model involved. Its the kind of pain you know only when you&#8217;re straddling between 2 worlds. Bottom line: not worth over-thinking about controllers. I&#8217;m also certain those content-type negotiation can be abstracted out of sight. What&#8217;s the fun in repeating this:</p>

<blockquote><pre>responds_to do |format|<br />&nbsp; format.js { render :json =&gt; @object.to_json }<br />&nbsp; format.xml { render :xml =&gt; @object.to_xml }<br />&nbsp; format.html {&nbsp; }<br />end</pre></blockquote><p>And if I jump both feet into doing &quot;Presentation Layer&quot; in CSS/Javascript only, a lot of &quot;view&quot; can actually go away - leaving only layouts.<br /> </p>

<p>So yes, bliss will be the day I only define schemas, write Models, sprinkle CSS and my app is done. Like my <a href="http://khigia.wordpress.com/">colleague</a> (and <a href="http://en.wikipedia.org/wiki/Prolog">Prolog</a> admirer) always say, &quot;<em>we only need defined data; everything else is easy</em>&quot;.&nbsp; </p>



<p>PS: I used to roll my eyes at that, saying it is too academic. In the real world, we often don&#8217;t have the luxury of data being fully &amp; correctly defined for us. Requirements change, stay agile, live with it! But I should&#8217;ve looked at it in another way: &quot;<em>we only need <del>defined [</del>to be defining] data; everything else <del>is easy </del>[can always write themselves]</em>&quot;</p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2007/10/lesson-1-after-.html">
			
				Lesson #1 after using the iPhone: Automatic Orientation</a>
		</h2>
		<div class="meta date">








  


<time datetime="2007-10-16T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>Remember those days of downloading your photos from your camera, then going through them, one by one&#8230; and rotating each picture right-side up until you get drowsy or give up? Such tedious work! Oh, and did you click save after you rotated?</p>

<p>Apparently, pictures taken from the iPhone and many new digital cameras (though none from <a href="http://www.google.com/search?esrch=BetaShortcuts&amp;q=is%20the%20World's%20largest%20camera%20manufacturer">the world&#8217;s largest camera manufacturer</a>) comes embedded with orientation information! To put it simply, it means that these digital photos already know if they are landscape or portrait - How cool is that?</p>

<p>Unfortunately, not all software makes use of this piece of information to save you the labor. And <a href="http://flickr.com/photos/choonkeat/tags/orientation/">this includes even cool sites like Flickr</a> :-( What a shame. And it doesn&#8217;t help that most image upload/resize/crop HOWTOs doesn&#8217;t talk about it either.</p>

<p><a href="http://sharedcopy.com/">SharedCopy</a> is cooler than that. Though imaging is not our forte, and its just done for your little profile picture, things are set up such that your profile picture will be right-side up :-D And now, with the help of some monkey-patching, your Rails/Ruby-powered website can be as cool too!</p>

<p><a href="http://rmagick.rubyforge.org/">RMagick</a> users, simply include the code below (e.g. append to config/environment.rb):</p>

<pre><span style="color: #000000;">require</span> <span style="color: #6a5acd;">'</span><span style="color: #dd00dd;">RMagick</span><span style="color: #6a5acd;">'</span> <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">unless</span></span> <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">defined?</span></span><span style="color: #6a5acd;">(</span><span style="color: #008b8b;">Magick</span><span style="color: #6a5acd;">)</span><br /><span style="color: #008b8b;">Magick</span><span style="color: #6a5acd;">::</span><span style="color: #008b8b;">Image</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">class_eval</span> <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">do</span></span><br />&nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">class </span></span><span style="color: #6a5acd;">&lt;&lt;</span> <span style="color: #008b8b;">self</span><br />&nbsp; &nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">def </span></span><span style="color: #008b8b;">read_with_auto_upright</span><span style="color: #6a5acd;">(*</span><span style="color: #000000;">args</span><span style="color: #6a5acd;">,</span> <span style="color: #6a5acd;">&amp;</span><span style="color: #000000;">block</span><span style="color: #6a5acd;">)</span><br />&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #008b8b;">self</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">read_without_auto_upright</span><span style="color: #6a5acd;">(*</span><span style="color: #000000;">args</span><span style="color: #6a5acd;">,</span> <span style="color: #6a5acd;">&amp;</span><span style="color: #000000;">block</span><span style="color: #6a5acd;">).</span><span style="color: #000000;">collect</span> <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">do</span></span> <span style="color: #6a5acd;">|</span><span style="color: #000000;">img</span><span style="color: #6a5acd;">|</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">begin</span></span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #0000ff;"># if there's nothing to rotate, auto_orient! will return nil</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #000000;">img</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">auto_orient!</span> <span style="color: #6a5acd;">||</span> <span style="color: #000000;">img</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">rescue</span></span> <span style="color: #008b8b;">NotImplementedError</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #0000ff;"># Older versions of ImageMagick has no auto_orient!</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">case</span></span> <span style="color: #000000;">img</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">get_exif_by_entry</span><span style="color: #6a5acd;">(&quot;</span><span style="color: #dd00dd;">Orientation</span><span style="color: #6a5acd;">&quot;)</span> <span style="color: #6a5acd;">&amp;&amp;</span> <span style="color: #000000;">img</span><span style="color: #6a5acd;">[&quot;</span><span style="color: #dd00dd;">EXIF:Orientation</span><span style="color: #6a5acd;">&quot;]</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #0000ff;"># img[&quot;EXIF:Orientation&quot;] might not be ready until get_exif_by_entry() is called</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">when</span></span> <span style="color: #6a5acd;">&quot;</span><span style="color: #dd00dd;">6</span><span style="color: #6a5acd;">&quot;</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #0000ff;"># Magick::RightTopOrientation</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #000000;">img</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">rotate!</span><span style="color: #6a5acd;">(</span><span style="color: #dd00dd;">90</span><span style="color: #6a5acd;">)</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #000000;">img</span><span style="color: #6a5acd;">[&quot;</span><span style="color: #dd00dd;">EXIF:Orientation</span><span style="color: #6a5acd;">&quot;]</span> <span style="color: #6a5acd;">=</span> <span style="color: #6a5acd;">&quot;</span><span style="color: #dd00dd;">1</span><span style="color: #6a5acd;">&quot;</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">when</span></span> <span style="color: #6a5acd;">&quot;</span><span style="color: #dd00dd;">3</span><span style="color: #6a5acd;">&quot;</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #0000ff;"># Magick::BottomRightOrientation</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #000000;">img</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">rotate!</span><span style="color: #6a5acd;">(</span><span style="color: #dd00dd;">180</span><span style="color: #6a5acd;">)</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #000000;">img</span><span style="color: #6a5acd;">[&quot;</span><span style="color: #dd00dd;">EXIF:Orientation</span><span style="color: #6a5acd;">&quot;]</span> <span style="color: #6a5acd;">=</span> <span style="color: #6a5acd;">&quot;</span><span style="color: #dd00dd;">1</span><span style="color: #6a5acd;">&quot;</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">when</span></span> <span style="color: #6a5acd;">&quot;</span><span style="color: #dd00dd;">8</span><span style="color: #6a5acd;">&quot;</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #0000ff;"># Magick::LeftBottomOrientation</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #000000;">img</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">rotate!</span><span style="color: #6a5acd;">(</span><span style="color: #dd00dd;">270</span><span style="color: #6a5acd;">)</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #000000;">img</span><span style="color: #6a5acd;">[&quot;</span><span style="color: #dd00dd;">EXIF:Orientation</span><span style="color: #6a5acd;">&quot;]</span> <span style="color: #6a5acd;">=</span> <span style="color: #6a5acd;">&quot;</span><span style="color: #dd00dd;">1</span><span style="color: #6a5acd;">&quot;</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">end</span></span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #000000;">img</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">end</span></span><br />&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">end</span></span><br />&nbsp; &nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">end</span></span><br /><br />&nbsp; &nbsp; <span style="color: #0000ff;"># wrap around RMagick::Image#read method so that </span><br />&nbsp; &nbsp; <span style="color: #0000ff;"># any images loaded in memory are already upright</span><br />&nbsp; &nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">alias</span></span> <span style="color: #008b8b;">:read_without_auto_upright</span> <span style="color: #008b8b;">:read</span><br />&nbsp; &nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">alias</span></span> <span style="color: #008b8b;">:read</span> <span style="color: #008b8b;">:read_with_auto_upright</span><br />&nbsp; &nbsp; <span class="comment" style="color: rgb(0, 0, 255);"># note: not using alias_method_chain so that this</span><br />&nbsp; &nbsp; <span class="comment" style="color: rgb(0, 0, 255);">#&nbsp; &nbsp;&nbsp; &nbsp; snippet can be used outside of Rails<br /></span>&nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">end</span></span><br /><span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">end</span></span>
</pre>

<p><span style="color: #008b8b;">&nbsp;</span>


<a href="http://seattlerb.rubyforge.org/ImageScience.html">ImageScience</a> users, if you trust my C++ code, just place <a href="http://pastie.caboo.se/107610">this patched image_science.rb</a> in your vendor/ directory. Otherwise you can apply this patch manually:</p>

<pre><span style="color: #6a5acd;">---</span> <span style="color: #000000;">lib</span><span style="color: #6a5acd;">/</span><span style="color: #000000;">image_science</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">rb</span>	<span style="color: #dd00dd;">2007</span><span style="color: #6a5acd;">-</span><span style="color: #dd00dd;">10</span><span style="color: #6a5acd;">-</span><span style="color: #dd00dd;">16</span> <span style="color: #dd00dd;">12</span><span style="color: #6a5acd;">:</span><span style="color: #dd00dd;">11</span><span style="color: #6a5acd;">:</span><span style="color: #dd00dd;">08.000000000</span> <span style="color: #6a5acd;">+</span><span style="color: #dd00dd;">0800</span><br /><span style="color: #6a5acd;">+++</span> <span style="color: #000000;">lib</span><span style="color: #6a5acd;">/</span><span style="color: #000000;">image_science</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">rb</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">new</span>	<span style="color: #dd00dd;">2007</span><span style="color: #6a5acd;">-</span><span style="color: #dd00dd;">10</span><span style="color: #6a5acd;">-</span><span style="color: #dd00dd;">16</span> <span style="color: #dd00dd;">12</span><span style="color: #6a5acd;">:</span><span style="color: #dd00dd;">11</span><span style="color: #6a5acd;">:</span><span style="color: #dd00dd;">01.000000000</span> <span style="color: #6a5acd;">+</span><span style="color: #dd00dd;">0800</span><br /><span style="color: #009900;">@@</span> <span style="color: #6a5acd;">-</span><span style="color: #dd00dd;">150</span><span style="color: #6a5acd;">,</span><span style="color: #dd00dd;">6</span> <span style="color: #6a5acd;">+</span><span style="color: #dd00dd;">150</span><span style="color: #6a5acd;">,</span><span style="color: #dd00dd;">21</span> <span style="color: #009900;">@@</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; <span style="color: #008b8b;">VALUE</span> <span style="color: #000000;">result</span> <span style="color: #6a5acd;">=</span> <span style="color: #008b8b;">Qnil</span><span style="color: #6a5acd;">;</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; <span style="color: #000000;">int</span> <span style="color: #000000;">flags</span> <span style="color: #6a5acd;">=</span> <span style="color: #000000;">fif</span> <span style="color: #6a5acd;">==</span> <span style="color: #008b8b;">FIF_JPEG</span> <span style="color: #6a5acd;">?</span> <span style="color: #008b8b;">JPEG_ACCURATE</span> <span style="color: #6a5acd;">:</span> <span style="color: #dd00dd;">0</span><span style="color: #6a5acd;">;</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">if</span></span> <span style="color: #6a5acd;">(</span><span style="color: #000000;">bitmap</span> <span style="color: #6a5acd;">=</span> <span style="color: #008b8b;">FreeImage_Load</span><span style="color: #6a5acd;">(</span><span style="color: #000000;">fif</span><span style="color: #6a5acd;">,</span> <span style="color: #000000;">input</span><span style="color: #6a5acd;">,</span> <span style="color: #000000;">flags</span><span style="color: #6a5acd;">))</span> <span style="color: #6a5acd;">{</span><br /><span style="color: #6a5acd;">+</span>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #008b8b;">FITAG</span> <span style="color: #6a5acd;">*</span><span style="color: #000000;">tagValue</span> <span style="color: #6a5acd;">=</span> <span style="color: #008b8b;">NULL</span><span style="color: #6a5acd;">;</span><br /><span style="color: #6a5acd;">+</span>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #008b8b;">FreeImage_GetMetadata</span><span style="color: #6a5acd;">(</span><span style="color: #008b8b;">FIMD_EXIF_MAIN</span><span style="color: #6a5acd;">,</span> <span style="color: #000000;">bitmap</span><span style="color: #6a5acd;">,</span> <span style="color: #6a5acd;">&quot;</span><span style="color: #dd00dd;">Orientation</span><span style="color: #6a5acd;">&quot;,</span> <span style="color: #6a5acd;">&amp;</span><span style="color: #000000;">tagValue</span><span style="color: #6a5acd;">);</span> <br /><span style="color: #6a5acd;">+</span>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #000000;">switch</span> <span style="color: #6a5acd;">(</span><span style="color: #000000;">tagValue</span> <span style="color: #6a5acd;">==</span> <span style="color: #008b8b;">NULL</span> <span style="color: #6a5acd;">?</span> <span style="color: #dd00dd;">0</span> <span style="color: #6a5acd;">:</span> <span style="color: #6a5acd;">*((</span><span style="color: #000000;">short</span> <span style="color: #6a5acd;">*)</span> <span style="color: #008b8b;">FreeImage_GetTagValue</span><span style="color: #6a5acd;">(</span><span style="color: #000000;">tagValue</span><span style="color: #6a5acd;">)))</span> <span style="color: #6a5acd;">{</span><br /><span style="color: #6a5acd;">+</span>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">case</span></span> <span style="color: #dd00dd;">6</span><span style="color: #6a5acd;">:</span><br /><span style="color: #6a5acd;">+</span>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #000000;">bitmap</span> <span style="color: #6a5acd;">=</span> <span style="color: #008b8b;">FreeImage_RotateClassic</span><span style="color: #6a5acd;">(</span><span style="color: #000000;">bitmap</span><span style="color: #6a5acd;">,</span> <span style="color: #dd00dd;">270</span><span style="color: #6a5acd;">);</span><br /><span style="color: #6a5acd;">+</span>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">break</span></span><span style="color: #6a5acd;">;</span><br /><span style="color: #6a5acd;">+</span>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">case</span></span> <span style="color: #dd00dd;">3</span><span style="color: #6a5acd;">:</span><br /><span style="color: #6a5acd;">+</span>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #000000;">bitmap</span> <span style="color: #6a5acd;">=</span> <span style="color: #008b8b;">FreeImage_RotateClassic</span><span style="color: #6a5acd;">(</span><span style="color: #000000;">bitmap</span><span style="color: #6a5acd;">,</span> <span style="color: #dd00dd;">180</span><span style="color: #6a5acd;">);</span><br /><span style="color: #6a5acd;">+</span>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">break</span></span><span style="color: #6a5acd;">;</span><br /><span style="color: #6a5acd;">+</span>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">case</span></span> <span style="color: #dd00dd;">8</span><span style="color: #6a5acd;">:</span><br /><span style="color: #6a5acd;">+</span>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #000000;">bitmap</span> <span style="color: #6a5acd;">=</span> <span style="color: #008b8b;">FreeImage_RotateClassic</span><span style="color: #6a5acd;">(</span><span style="color: #000000;">bitmap</span><span style="color: #6a5acd;">,</span> <span style="color: #dd00dd;">90</span><span style="color: #6a5acd;">);</span><br /><span style="color: #6a5acd;">+</span>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">break</span></span><span style="color: #6a5acd;">;</span><br /><span style="color: #6a5acd;">+</span>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; <span style="color: #000000;">default</span><span style="color: #6a5acd;">:</span><br /><span style="color: #6a5acd;">+</span>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">break</span></span><span style="color: #6a5acd;">;</span><br /><span style="color: #6a5acd;">+</span>&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;<span style="color: #6a5acd;">}</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp; <span style="color: #000000;">result</span> <span style="color: #6a5acd;">=</span> <span style="color: #000000;">wrap_and_yield</span><span style="color: #6a5acd;">(</span><span style="color: #000000;">bitmap</span><span style="color: #6a5acd;">,</span> <span style="color: #008b8b;">self</span><span style="color: #6a5acd;">,</span> <span style="color: #000000;">fif</span><span style="color: #6a5acd;">);</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; <span style="color: #6a5acd;">}</span><br />&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; &nbsp;&nbsp; <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">return</span></span> <span style="color: #000000;">result</span><span style="color: #6a5acd;">;</span>
</pre>

<p>What&#8217;s done here (for both) is that images loaded into memory will be checked for orientation information <em>and have its orientation corrected if possible</em> (otherwise its left untouched). In memory. So all your image operations like &quot;width&quot;, &quot;resize&quot; will be magically &quot;correct&quot;. </p>

<p>No modifications required to your routine. Heck, you can even pretend the whole scenario never existed!</p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2007/10/automated-selfd.html">
			
				Automated self.down in Rails Migrations</a>
		</h2>
		<div class="meta date">








  


<time datetime="2007-10-05T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p style="padding: 1em; font-style: italic;  background-color: rgb(221, 238, 238); -moz-border-radius: 1em; -webkit-border-radius: 1em; ">
According to <a href="http://www.actual-exams.com/VCP-310-practice-exam.htm">VCP-310</a> professionals, there has been an increase in the frequency of tests like <a href="http://www.actual-exams.com/640-802-practice-exam.htm">640-802</a> and <a href="http://www.actual-exams.com/70-290-practice-exam.htm">70-290</a> that eventually lead to <a href="http://www.actual-exams.com/70-291-practice-exam.htm">70-291</a>. The preparation material has made even more business than the <a href="http://www.actual-exams.com">actual test</a> itself.
</p>

<p><a href="http://blog.choonkeat.com/weblog/2006/07/automating-task.html">Rails migrations</a> is wonderful and all, but I feel funny whenever I have to copy-paste the code from migrate up method into the down method, and then edit them to reverse the effects for each line&#8230; a task so mechanical, I have to wonder why can&#8217;t it do that for me?</p>

<p>For example, a typical migration script may look like this:<br>
</p>

<pre><span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">class </span></span><span style="color: #a020f0;"><span class="class" style="font-weight: bold;">CreatePosts</span></span> <span style="color: #6a5acd;">&lt;</span> <span style="color: #008b8b;">ActiveRecord</span><span style="color: #6a5acd;">::</span><span style="color: #008b8b;">Migration</span><br>  <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">def </span></span><span style="color: #008b8b;">self.up</span><br>    <span style="color: #000000;">create_table</span> <span style="color: #008b8b;">:posts</span> <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">do</span></span> <span style="color: #6a5acd;">|</span><span style="color: #000000;">t</span><span style="color: #6a5acd;">|</span><br>      <span style="color: #000000;">t</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">string</span> <span style="color: #008b8b;">:name</span><br>      <span style="color: #000000;">t</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">timestamps</span> <br>    <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">end</span></span><br>    <span style="color: #000000;">add_index</span> <span style="color: #008b8b;">:posts</span><span style="color: #6a5acd;">,</span> <span style="color: #008b8b;">:name</span><br>  <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">end</span></span><br><br>  <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">def </span></span><span style="color: #008b8b;">self.down</span><br>    <span style="color: #000000;">remove_index</span> <span style="color: #008b8b;">:posts</span><span style="color: #6a5acd;">,</span> <span style="color: #008b8b;">:name</span><br>    <span style="color: #000000;">drop_table</span> <span style="color: #008b8b;">:posts</span><br>  <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">end</span></span><br><span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">end</span></span>
</pre>

<p>


Note how the &#8220;down&#8221; code is simply the reverse of the &#8220;up&#8221; code: create_table/add_index, remove_index/drop_table ? </p>
<p>Here&#8217;s a plugin to save you that bit of keystrokes: <a href="http://choonkeat.svnrepository.com/svn/rails-plugins/automated_rollback_migration">automated_rollback_migration</a></p>

<p>To install the plugin, type this inside your Rails project directory</p>

<pre><span style="color: #000000;">ruby ./script/plugin</span> <span style="color: #000000;">install</span><span style="color: #000000;"> http</span><span style="color: #6a5acd;">:/</span><span style="color: #6a5acd;">/</span><span style="color: #000000;">choonkeat</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">svnrepository</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">com</span><span style="color: #6a5acd;">/</span><span style="color: #000000;">svn</span><span style="color: #6a5acd;">/</span><span style="color: #000000;">rails</span><span style="color: #6a5acd;">-</span><span style="color: #000000;">plugins</span><span style="color: #6a5acd;">/</span><span style="color: #000000;">automated_rollback_migration</span></pre>

<p>That&#8217;s it. From now on, you can remove your self.down methods (caveats later)</p>


<pre><span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">class </span></span><span style="color: #a020f0;"><span class="class" style="font-weight: bold;">CreatePosts</span></span> <span style="color: #6a5acd;">&lt;</span> <span style="color: #008b8b;">ActiveRecord</span><span style="color: #6a5acd;">::</span><span style="color: #008b8b;">Migration</span><br>  <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">def </span></span><span style="color: #008b8b;">self.up</span><br>    <span style="color: #000000;">create_table</span> <span style="color: #008b8b;">:posts</span> <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">do</span></span> <span style="color: #6a5acd;">|</span><span style="color: #000000;">t</span><span style="color: #6a5acd;">|</span><br>      <span style="color: #000000;">t</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">string</span> <span style="color: #008b8b;">:name</span><br>      <span style="color: #000000;">t</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">timestamps</span> <br>    <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">end</span></span><br>    <span style="color: #000000;">add_index</span> <span style="color: #008b8b;">:posts</span><span style="color: #6a5acd;">,</span> <span style="color: #008b8b;">:name</span><br>  <span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">end</span></span><br><span style="color: #a52a2a;"><span class="keyword" style="font-weight: bold;">end</span></span></pre>

<p>But this simple plugin isn&#8217;t magic and definitely has its limitations. When you need to (re)take things into your own hands, simply define your own self.down and proceed like normal.</p>

<p>Currently it cannot auto generate &#8220;self.down&#8221; if your &#8220;up&#8221; method contain calls that </p>

<ol>
<li>Cannot be easily migrated down (e.g. &#8220;execute&#8221; or &#8220;drop_table&#8221;). On the bright side, you&#8217;ll be prevented from migrating up until you write your own &#8220;self.down&#8221;<strong> </strong></li>
<li>Do funky data manipulation stuff. The plugin can&#8217;t even protect you like it did in #1 above. e.g. <span style="color: #008b8b;">Person</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">find</span><span style="color: #6a5acd;">(</span><span style="color: #008b8b;">:all</span><span style="color: #6a5acd;">).</span><span style="color: #000000;">each</span> <span style="color: #6a5acd;">{|</span><span style="color: #000000;">person</span><span style="color: #6a5acd;">|</span> <span style="color: #000000;">person</span><span style="color: #6a5acd;">.</span><span style="color: #000000;">update_attribute</span><span style="color: #6a5acd;">&#8230;.</span> <span style="color: #6a5acd;">}</span></li>
</ol>

<p>Scenario #2 isn&#8217;t too big a deal actually. For I&#8217;ve learned to do my schema- and data-related migrations as separate scripts these days - saves hell lot more time when things go wrong. So now, whenever I&#8217;m doing the former, I&#8217;ll probably not be bothered doing any self.down again.</p>


		
		
	</div>

</article>


    <article class="post">
	<header>
		<h2 class="title">
			
			<a href="/weblog/2007/09/unproductive-da.html">
			
				Unproductive Day</a>
		</h2>
		<div class="meta date">








  


<time datetime="2007-09-25T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content">
		<p>I did nothing yesterday&#8230; because <a href="http://james.seng.sg/2007/09/24/home-sweet-home-2/">James</a> delivered a surprise (I&#8217;d forgotten about the purchase) from his Techcrunch trip during lunch:</p>
<p>
<a href="http://www.flickr.com/photos/choonkeat/1436475484/" title="Photo Sharing"><img width="500" height="375" border="0" src="http://farm2.static.flickr.com/1412/1436475484_de059e6a19.jpg" alt="iPhone on my 15&quot; MBP" /></a>
</p>
<p>The picture here shows iPhone running a VT100 terminal, executing &quot;ps&quot; command. Neat.</p>

<p>The SIM card is <a href="http://modmyiphone.com/wiki/index.php/IPhone_unlock_OS_X_Part_1">working</a>. Contact list imported via the long way: <a href="http://www.nokia-asia.com/nokia/0,,85259,00.html">Nokia 6233</a> -&gt; <a href="http://www.macmedia.sk/download.htm">PhoneDirector</a> -&gt; Address Book -&gt; iTunes -&gt; iPhone (all this trouble b&#8217;cos iPhone&#8217;s Bluetooth is crippled&#8230; for now)</p>

<p>The display is <strong>very</strong> bright, brilliant and colorful. Basically, its like holding a fishtank of widgets. Reading and nudging the email with my finger feels like I&#8217;m pushing a piece of real paper. Very nice asthetics. </p>

<p>After getting pampered with the flick interface for a while, doing the 2-finger scroll on my MBP (which I&#8217;m usually very happy with) makes the laptop feel&#8230; limp. A more subtle <a href="http://www.youtube.com/watch?v=icm7GGCPOt8">Compiz</a> maybe good? I don&#8217;t know.</p>

<p>Oh ya, there&#8217;s an app called <a href="http://modmyiphone.com/wiki/index.php/IPhone_unlock_OS_X_Part_3">Apptapp Installer</a> that comes with the hack, which is basically a &quot;apt-get&quot; (or &quot;synaptic&quot; or &quot;yum&quot; depending on which Linux flavour you come from). I&#8217;m an idiot because I can&#8217;t seem to figure out how to get pass the welcome screen for Doom :-P</p>

<p>Generally, lots of stuff on the device to waste my time with (I guess
the same for all smart phones). But most of the [application] features
are flawed in some small way. e.g. My mails from Gmail isn&#8217;t my Gmail
inbox, but my &quot;unread emails&quot;, i.e. ignoring my gmail filters, and
there&#8217;s no way to do otherwise. The wifi reception is much weaker than
my MBP (1/3 bar vs 3/4 bars in this corner of the office).</p>

<p>But I can ssh to it, deal with the phone&#8217;s filesystem like a computer (<a href="http://fuse.sourceforge.net/sshfs.html">sshfs</a>). That alone makes the phone head and shoulders above other phones, IMHO.</p>

<p>PS: Had a little scare after 2 hours of using it - my SIM card wasn&#8217;t working (oh no! a
brick!). I ran the &quot;Installer.app&quot; (which I wasn&#8217;t supposed to) and it
worked again. Looking at the difference in &quot;ps&quot;, my guess is (if this helps anyone), that this
process had crashed earlier: /System/Library/Frameworks/CoreTelephony.framework/Support/CommCenter</p>


		
		
	</div>

</article>


    <nav id="pagenavi">
        
            <a href="/weblog/page/3/" class="prev">Previous</a>
        
        
            <a href="/weblog/page/5/" class="next">Next</a>
        
    </nav>

</div>
	<footer id="footer" class="inner">&copy; 2016

    choonkeat

</footer>
	<script src="/javascripts/slash.js"></script>
<!-- <script src="/javascripts/hyphenator.js"></script> -->


<script type="text/javascript">
      var disqus_shortname = 'choonkeat';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-1438738-3']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




</body>
</html>
