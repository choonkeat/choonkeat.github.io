
<!DOCTYPE HTML>
<html lang="en-GB">
<head>
	<meta charset="utf-8">
	<title>KRJS: RJS without messing the Views  | The Devel!</title>

	<meta name="author" content="choonkeat">

<meta name="description" content="   RJS is great and awesome. I use it quite regularly now. With RJS, I don&#8217;t have to deal with which parts of the page to update in the rhtml..."> <meta name="keywords" content="">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="http://feeds.feedburner.com/choonkeat" rel="alternate" title="The Devel!" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<link href="/stylesheets/application.css" media="screen, projection" rel="stylesheet" type="text/css">
<script src="/javascripts/application.js"></script>

</head>



<body>
	<header id="header" class="inner"><h1><a href="/">The Devel!</a></h1>
<span class="tagline">choonkeat on programming & software</span>
<nav id="main-nav"><ul>
	<li><a href="/weblog/chew-choon-keat.html">About</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/weblog/chew-choon-keat.html">About</a></li>
	<li><a href="/archives">Archives</a></li>
</ul>
</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<header>
		<h2 class="title">KRJS: RJS without messing the Views</h2>
		<div class="meta date">








  


<time datetime="2006-06-12T00:00:00+08:00" pubdate data-updated="true"></time></div>
	</header>
	<div class="entry-content"><p>   <p>RJS is great and awesome. I use it quite regularly now. With RJS, I don&#8217;t have to deal with <em>which parts of the page to update</em> in the rhtml files - I get to decide whilst in my controller using the nice and elegant <a href="http://codefluency.com/articles/2006/05/27/rails-views-render-update-not-rjs/">render :update</a>. Sweet. </p>             <p>But part of me wished I didn&#8217;t have to even decide <em>which page elements are to be ajaxified</em>. I&#8217;d wish I could more easily enable a link, form or button to make ajax calls without going back and touching my html&#8230; <br />       </p>             <p>Oh well. </p>             <p>Introducing the <a href="http://choonkeat.svnrepository.com/svn/rails-plugins/krjs/">KRJS plugin</a>, with less than 60 lines of patch to Rails&#8217; ActionPack itself (which probably means bugs are aplenty, would slow production sites to a crawl, and that its fresh from the oven too)</p>             <p>To see KRJS in action (<em>so what does it do?</em>), generate a blank controller and index action:<br />   </p>     <pre><font color="#990000">.</font>/script/generate controller Sample index</pre>   <p>Give it a decent layout (include javascripts) by creating the file app/views/layouts/sample.rhtml<br />   </p>     <pre><font color="#990000">&lt;</font><font color="#990000">!</font>DOCTYPE html PUBLIC <font color="#ff0000">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</font><br />     <font color="#ff0000">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</font><font color="#990000">&gt;</font><br />   <font color="#ff0000">&lt;html&gt;</font><br />   <font color="#ff0000">&lt;head&gt;</font><br />     <font color="#990000">&lt;</font><font color="#990000">%</font><font color="#990000">=</font> javascript_include_tag <font color="#990000">:</font>defaults <font color="#990000">%</font><font color="#990000">&gt;</font><br />   <font color="#ff0000">&lt;/head&gt;</font><br />   <font color="#ff0000">&lt;body&gt;</font><br />   <font color="#990000">&lt;</font><font color="#990000">%</font><font color="#990000">=</font> <font color="#009900">@content_for_layout</font> <font color="#990000">%</font><font color="#990000">&gt;</font><br />   <font color="#ff0000">&lt;/body&gt;</font><br />   <font color="#ff0000">&lt;/html&gt;</font> </pre>           <p>Create a sample form: <br />   </p>     <pre><font color="#990000">&lt;</font><font color="#990000">%</font><font color="#990000">=</font> <strong><font color="#000000">form_tag</font></strong><font color="#990000">(</font><font color="#ff0000">{</font><font color="#990000">:</font>action <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#ff0000">'submit'</font><font color="#ff0000">}</font><font color="#990000">,</font> <font color="#ff0000">{</font><font color="#990000">:</font>id <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#ff0000">'form'</font><font color="#ff0000">}</font><font color="#990000">)</font> <font color="#990000">%</font><font color="#990000">&gt;</font><br />     <font color="#990000">&lt;</font><font color="#990000">%</font><font color="#990000">=</font> text_field <font color="#ff0000">'account'</font><font color="#990000">,</font> <font color="#ff0000">'login'</font><font color="#990000">,</font> <font color="#990000">:</font>id <font color="#990000">=</font><font color="#990000">&gt;</font> <font color="#ff0000">'account-new-login'</font> <font color="#990000">%</font><font color="#990000">&gt;</font><font color="#990000">&lt;</font>br <font color="#990000">/</font><font color="#990000">&gt;</font><br />     <font color="#990000">&lt;</font><font color="#990000">%</font><font color="#990000">=</font> submit_tag <font color="#ff0000">'Login'</font> <font color="#990000">%</font><font color="#990000">&gt;</font><br />   <font color="#990000">&lt;</font><font color="#990000">%</font><font color="#990000">=</font> end_form_tag <font color="#990000">%</font><font color="#990000">&gt;</font> </pre>          <p>This will be the last time we&#8217;re touch the Views. If you visit the page now, you should see a simple form. This is the most basic Rails app. It will be our mickey mouse app for this session:<br />   </p>             <p><a title="Photo Sharing" href="http://www.flickr.com/photos/choonkeat/165073750/"><img width="240" height="93" border="0" alt="KRJS walkthru: Default form" src="http://static.flickr.com/49/165073750_19cba41a79_m.jpg" /></a></p>             <p>Clicking on Login leads you to an even simpler error page:</p>           <p><a title="Photo Sharing" href="http://www.flickr.com/photos/choonkeat/165073835/"><img width="240" height="94" border="0" alt="KRJS walkthru: Default page after submitting form" src="http://static.flickr.com/64/165073835_c5d9f5608a_m.jpg" /></a></p>             <p>This is because we didn&#8217;t have any code to handle the form submit. Don&#8217;t let that stop us web2.0-ers, let&#8217;s ajaxify it anyways! First, install the <a href="http://choonkeat.svnrepository.com/svn/rails-plugins/krjs/">KRJS plugin</a> </p><pre><font color="#990000">.</font>/script/plugin install http://choonkeat.svnrepository.com/svn/rails-plugins/krjs/</pre><p>and <strong>restart your server</strong>.</p>         <p>Now, try to view the page, and click on the Login button&#8230;. same error page. Good! That means KRJS didn&#8217;t mess up the original app. Now let&#8217;s add a new method into the controller, app/controllers/sample_controller.rb<br />     </p>         <pre>  <strong><font color="#0000ff">def</font></strong> on_form_submit<br />       render <font color="#990000">:</font>update <strong><font color="#0000ff">do</font></strong> <font color="#990000">|</font>page<font color="#990000">|</font><br />         page<font color="#990000">.</font>insert_html <font color="#990000">:</font>after<font color="#990000">,</font> <font color="#ff0000">'form'</font><font color="#990000">,</font> CGI<font color="#990000">.</font><strong><font color="#000000">escapeHTML</font></strong><font color="#990000">(</font>params<font color="#990000">.</font>inspect<font color="#990000">)</font><br />       <strong><font color="#0000ff">end</font></strong><br />     <strong><font color="#0000ff">end</font></strong></pre>   <p>&nbsp;</p>         <p>Refresh the page, and click on Login</p>         <p><a title="Photo Sharing" href="http://www.flickr.com/photos/choonkeat/165073881/"><img width="240" height="93" border="0" alt="KRJS walkthru: Result page after installing KRJS and clicking form" src="http://static.flickr.com/45/165073881_98a6576eac_m.jpg" /></a></p>         <p>As you can see, the form has become ajaxified - to update the page instead of sending the browser to a new location - by merely adding a new corresponding method in the controller! How about adding this to the controller:</p>       <p>&nbsp;</p>     <pre>  <strong><font color="#0000ff">def</font></strong> on_account_login_blur<br />       render <font color="#990000">:</font>update <strong><font color="#0000ff">do</font></strong> <font color="#990000">|</font>page<font color="#990000">|</font><br />         page<font color="#990000">.</font>insert_html <font color="#990000">:</font>after<font color="#990000">,</font> <font color="#ff0000">'form'</font><font color="#990000">,</font> CGI<font color="#990000">.</font><strong><font color="#000000">escapeHTML</font></strong><font color="#990000">(</font>params<font color="#990000">.</font>inspect<font color="#990000">)</font><br />       <strong><font color="#0000ff">end</font></strong><br />     <strong><font color="#0000ff">end</font></strong></pre>   <p>&nbsp;</p>       <p>Refresh the page, type something into the textfield and TAB away from the field:<br />   </p>       <p><a title="Photo Sharing" href="http://www.flickr.com/photos/choonkeat/165073907/"><img width="240" height="94" border="0" alt="KRJS walkthru: Result page after losing focus on text field" src="http://static.flickr.com/44/165073907_898d68f271_m.jpg" /></a></p>             <p>Yea, KRJS registers onBlur events as well. In fact, it&#8217;ll register onClick, onSubmit, onWatever, onYouwant because it doesn&#8217;t really care. All that matters is your HTML element&#8217;s ID attribute. <a href="http://choonkeat.svnrepository.com/svn/rails-plugins/krjs/">KRJS</a> currently identifies xhr actions by naming conventions, hence it will probably be most convenient to be used with <a href="http://choonkeat.svnrepository.com/svn/rails-plugins/dashed_dom_id/">dashed_</a><a href="http://choonkeat.svnrepository.com/svn/rails-plugins/dashed_dom_id/">dom_id plugin</a>.&nbsp;</p>     <p>Go ahead, give it a spin. I&#8217;m going to sleep.. hope I don&#8217;t wake into a world of horror&#8230; <br />   </p><p>[Updated plugin links]&nbsp;</p></p>

</div>
	

</article>

	
	<div class="share">
		<ul>
			<li>
  <a href="https://twitter.com/intent/tweet?text=KRJS: RJS without messing the Views by @choonkeat&url=http://choonkeat.github.com/choonkeat/weblog/2006/06/krjs-rjs-withou.html" title="Share KRJS: RJS without messing the Views on Twitter">
    <img src="/images/social/twitter.png" />
  </a>
</li>

			<li>
  <a href="https://www.facebook.com/sharer.php?u=http://choonkeat.github.com/choonkeat/weblog/2006/06/krjs-rjs-withou.html" title="Share KRJS: RJS without messing the Views on Facebook">
    <img src="/images/social/facebook.png" />
  </a>
</li>

			<li>
  <a href="https://plus.google.com/share?url=http://choonkeat.github.com/choonkeat/weblog/2006/06/krjs-rjs-withou.html" title="Share KRJS: RJS without messing the Views on Google Plus">
    <img src="/images/social/google.png" />
  </a>
</li>

		</ul>
	</div>



</div>
	<footer id="footer" class="inner">&copy; 2016

    choonkeat

</footer>
	<script src="/javascripts/slash.js"></script>
<!-- <script src="/javascripts/hyphenator.js"></script> -->


<script type="text/javascript">
      var disqus_shortname = 'choonkeat';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-1438738-3']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>




</body>
</html>
