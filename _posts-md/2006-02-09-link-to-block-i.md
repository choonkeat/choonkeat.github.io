---
layout: post
title: link_to_block in Rails?
published: true
category:
- software
---
Ever since [Seaside](http://www.seaside.st/) was featured in [Ruby On Rails podcast](http://podcast.rubyonrails.com/), I was wondering if there's any use for having a **link\_to\_block** method...

      \<% variable = Time.now %\>
      \<%= link\_to\_block(<font>"Click me to execute a block of code"</font>) do |c| 
      c.render(:text =\> <font>"Time.now = \"#{Time.now}\"&lt;br /&gt;variable = \"#{variable}\""</font>)
      end %\> 

I guess the only way to find out is to have it available first...

      # paste everything into app/controllers/application.rb
      # to empower all your controllers
      
      # all links generated by 'link\_to\_block' goes here
      def continued
      # should probably use Drb Hash object instead of global variable $PROCHASH
      if $PROCHASH and $PROCHASH[@session.session\_id] and
      (block = $PROCHASH[@session.session\_id][params[:id]]) and 
      block.respond\_to?(:call) 
      block.call(self) 
      else
      raise <font>"No block to continue for '#{params[:id]}'"</font>
      end
      end
    
      # similar to 'link\_to', but accepts a block of code instead of URL/HTTP options
      # when clicked, the block is executed
      def link\_to\_block(text, &block)
      # should probably use Drb Hash object instead of global variable $PROCHASH
      $PROCHASH ||= Hash.new(:created\_at =\> Time.now)
      action\_name = text.to\_sym.to\_s
      $PROCHASH[@session.session\_id] ||= Hash.new
      $PROCHASH[@session.session\_id].merge!({
      action\_name =\> Proc.new(&block),
      })
      # we do have to remember to house-keep this hash... someday
      url = url\_for(:action =\> 'continued', :id =\> action\_name)
      <font>"&lt;a xhref=\"#{url}\"&gt;#{CGI.escapeHTML(text)}&lt;/a&gt;"</font>
      end
      
      # makes it accessible within views (e.g. rhtml)
      helper\_method :link\_to\_block  

  

An example of clicking a link\_to\_block and seeing the variable in the block...

[![](http://static.flickr.com/32/97508279_7956d55e5c.jpg)](http://www.flickr.com/photos/choonkeat/97508279/)   
